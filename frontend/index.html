<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KWASU Lost & Found Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #1a5276;
            --secondary-color: #2980b9;
            --accent-color: #f39c12;
            --light-bg: #ecf0f1;
            --supporter-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --message-sent: #dcf8c6;
            --message-received: #f1f0f0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: #333;
            padding-top: 70px; /* Space for sticky header */
        }
        
        /* Sticky Header */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }
        
        .header-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .nav-menu li {
            margin-left: 20px;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }
        
        .nav-menu a:hover {
            opacity: 0.8;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            cursor: pointer;
        }
        
        /* Hamburger Menu for Mobile */
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 70px);
                background-color: var(--primary-color);
                flex-direction: column;
                align-items: center;
                justify-content: flex-start;
                padding-top: 30px;
                transition: left 0.3s ease;
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-menu li {
                margin: 15px 0;
            }
            
            .user-menu {
                margin-top: 20px;
            }
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 4rem 0;
            text-align: center;
        }
        
        .hero-section h1 {
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .hero-section p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .section-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .section-card:hover {
            transform: translateY(-5px);
        }
        
        .section-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--accent-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .search-results {
            margin-top: 2rem;
        }
        
        .result-item {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid var(--accent-color);
        }
        
        .result-item h5 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .result-item .meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .result-item .meta i {
            margin-right: 5px;
        }
        
        .badge {
            font-size: 0.8rem;
            padding: 5px 10px;
        }
        
        .badge-lost {
            background-color: #e74c3c;
        }
        
        .badge-found {
            background-color: #2ecc71;
        }
        
        .badge-recovered {
            background-color: #17a2b8;
        }
        
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            margin-top: 4rem;
            text-align: center;
        }
        
        .footer a {
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .toast-success {
            border-left: 4px solid #2ecc71;
        }
        
        .toast-error {
            border-left: 4px solid #e74c3c;
        }
        
        .toast-body {
            position: relative;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .platform-icons {
            margin-top: 1rem;
        }
        
        .platform-icons a {
            color: white;
            font-size: 1.5rem;
            margin: 0 10px;
            transition: transform 0.3s ease;
        }
        
        .platform-icons a:hover {
            transform: scale(1.2);
        }
        
        .whatsapp-note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .safety-tips {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .safety-tips h5 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .safety-tips ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .safety-tips li {
            margin-bottom: 8px;
            color: #856404;
        }
        
        .safety-tips li:last-child {
            margin-bottom: 0;
        }
        
        .safety-tips i {
            color: #ffc107;
            margin-right: 8px;
        }
        
        /* Simple Section Break */
        .section-break {
            height: 2px;
            background: linear-gradient(to right, transparent, #ddd, transparent);
            margin: 3rem 0;
        }
        
        /* Enhanced Supporters Section */
        .supporters-section {
            background: var(--supporter-gradient);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 1rem;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .supporters-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(0.8); opacity: 0.5; }
        }
        
        .supporters-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .supporters-counter {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
            display: inline-block;
            min-width: 80px;
        }
        
        .supporters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .supporter-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .supporter-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .supporter-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 0.8rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .supporter-avatar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6ec7, #7873f5, #4bcffa, #f093fb);
            border-radius: 50%;
            z-index: -1;
            animation: rotate 3s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .supporter-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
        }
        
        .supporter-role {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 0.4rem;
        }
        
        .supporter-department {
            font-size: 0.8rem;
            opacity: 0.7;
            font-style: italic;
        }
        
        .toggle-supporters-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }
        
        .toggle-supporters-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .collapse {
            transition: max-height 0.5s ease;
        }
        
        .supporter-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--accent-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Floating particles animation */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: none;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Matching Items Modal */
        .matching-item-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-color);
        }
        
        .matching-item-card h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .matching-item-card .detail-row {
            display: flex;
            margin-bottom: 0.75rem;
        }
        
        .matching-item-card .detail-label {
            font-weight: 600;
            width: 120px;
            color: #555;
        }
        
        .matching-item-card .detail-value {
            flex: 1;
        }
        
        .matching-item-card .contact-btn {
            margin-top: 1rem;
            display: inline-block;
            background-color: #25D366;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .matching-item-card .contact-btn:hover {
            background-color: #128C7E;
            color: white;
        }
        
        /* Verification Modal */
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px 15px 0 0;
            border: none;
        }
        
        .modal-title {
            font-weight: 600;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        /* Founder Details Modal */
        .founder-details {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .founder-details h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .founder-details .detail-row {
            display: flex;
            margin-bottom: 0.75rem;
        }
        
        .founder-details .detail-label {
            font-weight: 600;
            width: 120px;
            color: #555;
        }
        
        .founder-details .detail-value {
            flex: 1;
        }
        
        .founder-details .contact-btn {
            margin-top: 1rem;
            display: inline-block;
            background-color: #25D366;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .founder-details .contact-btn:hover {
            background-color: #128C7E;
            color: white;
        }
        
        /* Found Item Actions */
        .found-item-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .claimed-status {
            background-color: #28a745;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* New styles for report details modal */
        .report-details-modal .modal-dialog {
            max-width: 600px;
        }
        
        .report-details-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .report-details-card h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .report-details-card .detail-row {
            display: flex;
            margin-bottom: 1rem;
        }
        
        .report-details-card .detail-label {
            font-weight: 600;
            width: 140px;
            color: #555;
        }
        
        .report-details-card .detail-value {
            flex: 1;
        }
        
        .verification-code-box {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            letter-spacing: 2px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .verification-code-box:hover {
            background-color: #dee2e6;
            transform: scale(1.02);
        }
        
        .copy-tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .copy-tooltip.show {
            opacity: 1;
        }
        
        .toast-action-btn {
            margin-top: 10px;
        }
        
        .safety-alert {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .safety-alert h6 {
            color: #721c24;
            margin-bottom: 10px;
        }
        
        .safety-alert p {
            color: #721c24;
            margin-bottom: 0;
        }
        
        .verification-input-group {
            margin: 1.5rem 0;
        }
        
        .verification-input {
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            letter-spacing: 3px;
        }
        
        .forgot-code-tip {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }
        
        .guide-section {
            background-color: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .guide-section h6 {
            color: #004c99;
            margin-bottom: 10px;
        }
        
        .guide-section ol {
            color: #004c99;
            padding-left: 20px;
        }
        
        .guide-section li {
            margin-bottom: 8px;
        }
        
        .guide-section li:last-child {
            margin-bottom: 0;
        }
        
        .importance-note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .importance-note h6 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .importance-note p {
            color: #856404;
            margin-bottom: 0;
        }
        
        .mark-as-recovered-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .mark-as-recovered-btn:hover {
            background-color: #138496;
            color: white;
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .verification-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-icon {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .lost-verification-modal .modal-body {
            text-align: center;
        }
        
        /* Messaging System Styles */
        .messaging-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .messaging-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .conversation-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
        }
        
        .conversation-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .conversation-item:hover {
            background-color: #f1f1f1;
        }
        
        .conversation-item.active {
            background-color: #e3f2fd;
            border-left: 4px solid var(--secondary-color);
        }
        
        .conversation-item:last-child {
            border-bottom: none;
        }
        
        .conversation-preview {
            display: flex;
            justify-content: space-between;
        }
        
        .conversation-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 4px;
        }
        
        .conversation-message {
            font-size: 0.9rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70%;
        }
        
        .conversation-time {
            font-size: 0.8rem;
            color: #999;
        }
        
        .conversation-unread {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .message-modal .modal-dialog {
            max-width: 800px;
            height: 600px;
        }
        
        .message-modal .modal-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .message-modal .modal-header {
            flex-shrink: 0;
        }
        
        .message-modal .modal-body {
            flex-grow: 1;
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .message-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #f5f5f5;
        }
        
        .message {
            max-width: 70%;
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }
        
        .message-sent {
            background-color: var(--message-sent);
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .message-received {
            background-color: var(--message-received);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: #999;
            text-align: right;
            margin-top: 5px;
        }
        
        .message-received .message-time {
            text-align: left;
        }
        
        .message-input-container {
            padding: 15px;
            border-top: 1px solid #ddd;
            background-color: white;
        }
        
        .message-input {
            border-radius: 20px;
            border: 1px solid #ddd;
            padding: 10px 20px;
            resize: none;
            height: auto;
            max-height: 120px;
        }
        
        .message-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .message-safety-tips {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .message-safety-tips i {
            color: #ffc107;
            margin-right: 5px;
        }
        
        .share-info-btn {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
            color: #495057;
        }
        
        .share-info-btn:hover {
            background-color: #e9ecef;
        }
        
        .report-conversation-btn {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
            color: #721c24;
        }
        
        .report-conversation-btn:hover {
            background-color: #f1b0b7;
        }
        
        .message-info-shared {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #155724;
        }
        
        .message-info-shared i {
            color: #28a745;
            margin-right: 5px;
        }
        
        .no-conversations {
            text-align: center;
            padding: 30px;
            color: #666;
        }
        
        .no-conversations i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .message-contact-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .message-contact-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .message-contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .message-contact-info {
            flex-grow: 1;
        }
        
        .message-contact-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .message-contact-item {
            font-size: 0.9rem;
            color: #666;
        }
        
        .message-contact-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-message {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .btn-message:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-message-outline {
            background-color: transparent;
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .btn-message-outline:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .message-status {
            font-size: 0.75rem;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }
        
        .message-verification-pending {
            color: var(--accent-color);
        }
        
        .message-verification-complete {
            color: #28a745;
        }
        
        /* WhatsApp Visibility Toggle */
        .whatsapp-visibility {
            background-color: #e8f5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .whatsapp-visibility h6 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .form-check {
            margin-bottom: 10px;
        }
        
        .form-check-input:checked {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-check-label {
            font-weight: 500;
        }
        
        /* Registration and Login Styles */
        .auth-modal .modal-dialog {
            max-width: 450px;
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }
        
        .auth-content {
            display: none;
        }
        
        .auth-content.active {
            display: block;
        }
        
        .verification-method {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .verification-method .btn {
            flex: 1;
        }
        
        .verification-input-group {
            display: none;
            margin-top: 15px;
        }
        
        .verification-input-group.active {
            display: block;
        }
        
        .notification-settings {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .notification-settings h6 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .notification-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .notification-setting:last-child {
            margin-bottom: 0;
        }
        
        /* Image Upload Styles */
        .image-upload-container {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .image-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: cover;
            display: none;
        }
        
        .image-preview.show {
            display: block;
        }
        
        .message-image {
            max-width: 250px;
            max-height: 250px;
            border-radius: 8px;
            margin-top: 5px;
            cursor: pointer;
        }
        
        .contact-details-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }
        
        .contact-details-container.show {
            display: block;
        }
        
        .contact-detail-item {
            display: flex;
            margin-bottom: 5px;
        }
        
        .contact-detail-label {
            font-weight: 600;
            width: 80px;
            color: #555;
        }
        
        .contact-detail-value {
            flex: 1;
        }
        
        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 350px;
            max-height: 400px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 999;
            display: none;
            overflow: hidden;
            flex-direction: column;
        }
        
        .notification-panel.show {
            display: flex;
        }
        
        .notification-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .notification-list {
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .notification-item:hover {
            background-color: #f8f9fa;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item.unread {
            background-color: #f0f7ff;
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: #999;
            margin-top: 5px;
        }
        
        .no-notifications {
            padding: 30px;
            text-align: center;
            color: #999;
        }
        
        .no-notifications i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }
        
        /* Registration Prompt */
        .registration-prompt {
            background-color: #e3f2fd;
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .registration-prompt h6 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .registration-prompt p {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Sticky Header -->
    <header class="sticky-header">
        <div class="container">
            <div class="header-content">
                <button class="menu-toggle" id="menu-toggle">
                    <i class="bi bi-list"></i>
                </button>
                <div>
                    <h1 class="header-title">KWASU LOST & FOUND PORTAL</h1>
                    <p class="header-subtitle">Report lost items, found items, or search for your belongings across all platforms</p>
                </div>
                <div class="user-menu">
                    <div class="user-avatar" id="user-avatar" style="display: none;">
                        <i class="bi bi-person"></i>
                    </div>
                    <div class="position-relative" id="notification-container" style="display: none;">
                        <button class="btn btn-sm btn-outline-light" id="notification-btn">
                            <i class="bi bi-bell"></i>
                        </button>
                        <span class="notification-badge" id="notification-count">0</span>
                    </div>
                </div>
            </div>
        </div>
        <nav class="nav-menu" id="nav-menu">
            <li><a href="#" id="nav-home">Home</a></li>
            <li><a href="#" id="nav-report-lost">Report Lost Item</a></li>
            <li><a href="#" id="nav-report-found">Report Found Item</a></li>
            <li><a href="#" id="nav-search">Search Items</a></li>
            <li><a href="#" id="nav-messages">Messages</a></li>
            <li><a href="#" id="nav-safety">Safety Tips</a></li>
            <li><a href="#" id="nav-supporters">Supporters</a></li>
            <li><hr class="my-2 text-white-50"></li></li>
            <li><a href="#" id="nav-login"><i class="bi bi-box-arrow-in-right"></i> Login</a></li>
            <li><a href="#" id="nav-register"><i class="bi bi-person-plus"></i> Register</a></li>
        </nav>
    </header>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notification-panel">
        <div class="notification-header">
            <div class="notification-title">Notifications</div>
            <button class="btn btn-sm" id="clear-notifications">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <div class="notification-list" id="notification-list">
            <div class="no-notifications">
                <i class="bi bi-bell-slash"></i>
                <p>No notifications</p>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section" id="home">
        <div class="container">
            <h1>KWASU Lost & Found Portal</h1>
            <p>Report lost items, found items, or search for your belongings across all platforms</p>
            <div class="platform-icons">
                <a href="https://t.me/KwasuLostFound_Bot" target="_blank" title="Telegram Bot"><i class="bi bi-telegram"></i></a>
                <a href="https://wa.link/9765zr" target="_blank" title="WhatsApp Bot"><i class="bi bi-whatsapp"></i></a>
            </div>
        </div>
    </section>

    <div class="container my-5">
        <div class="row">
            <!-- Report Lost Item Section -->
            <div class="col-lg-6 mb-4" id="report-lost-section">
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="bi bi-search"></i> Report Lost Item
                    </h3>
                    <div class="whatsapp-note">
                        <i class="bi bi-whatsapp"></i> <strong>Important:</strong> Please provide your WhatsApp number for faster communication.
                    </div>
                    <form id="lost-item-form">
                        <div class="mb-3">
                            <label for="lost-item" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="lost-item" placeholder="e.g., Water Bottle, Wallet, Phone" required>
                        </div>
                        <div class="mb-3">
                            <label for="lost-location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="lost-location" placeholder="e.g., Library, Cafeteria, Lecture Hall" required>
                        </div>
                        <div class="mb-3">
                            <label for="lost-last-seen" class="form-label">Last Seen Location (if known)</label>
                            <input type="text" class="form-control" id="lost-last-seen" placeholder="e.g., Near the library entrance, Cafeteria table 5">
                        </div>
                        <div class="mb-3">
                            <label for="lost-description" class="form-label">Description</label>
                            <textarea class="form-control" id="lost-description" rows="3" placeholder="Provide details about your item (color, brand, unique features, etc.)" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="lost-contact" class="form-label">Your WhatsApp Number</label>
                            <input type="tel" class="form-control" id="lost-contact" placeholder="e.g., 08012345678" required>
                        </div>
                        
                        <!-- WhatsApp Visibility Option -->
                        <div class="whatsapp-visibility">
                            <h6><i class="bi bi-eye"></i> WhatsApp Number Visibility</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="lost-whatsapp-visibility" id="lost-whatsapp-visible" value="visible" checked>
                                <label class="form-check-label" for="lost-whatsapp-visible">
                                    Show my WhatsApp number in search results
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="lost-whatsapp-visibility" id="lost-whatsapp-hidden" value="hidden">
                                <label class="form-check-label" for="lost-whatsapp-hidden">
                                    Only share my number when I respond to messages
                                </label>
                            </div>
                        </div>
                        
                        <!-- Registration Prompt -->
                        <div class="registration-prompt" id="lost-registration-prompt" style="display: none;">
                            <h6><i class="bi bi-info-circle"></i> Registration Required</h6>
                            <p>You've chosen to only share your WhatsApp number when you respond to messages. This requires registration to use our secure messaging system.</p>
                            <button type="button" class="btn btn-primary" id="lost-register-btn">
                                <i class="bi bi-person-plus"></i> Register Now
                            </button>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">Report Lost Item</button>
                    </form>
                </div>
            </div>

            <!-- Report Found Item Section -->
            <div class="col-lg-6 mb-4" id="report-found-section">
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="bi bi-gift"></i> Report Found Item
                    </h3>
                    <div class="whatsapp-note">
                        <i class="bi bi-whatsapp"></i> <strong>Important:</strong> Please provide your WhatsApp number for faster communication.
                    </div>
                    <form id="found-item-form">
                        <div class="mb-3">
                            <label for="found-item" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="found-item" placeholder="e.g., Keys, ID Card, Notebook" required>
                        </div>
                        <div class="mb-3">
                            <label for="found-location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="found-location" placeholder="e.g., Parking Lot, Classroom, Sports Complex" required>
                        </div>
                        <div class="mb-3">
                            <label for="found-contact" class="form-label">Your WhatsApp Number</label>
                            <input type="tel" class="form-control" id="found-contact" placeholder="e.g., 08012345678" required>
                        </div>
                        
                        <!-- WhatsApp Visibility Option -->
                        <div class="whatsapp-visibility">
                            <h6><i class="bi bi-eye"></i> WhatsApp Number Visibility</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="found-whatsapp-visibility" id="found-whatsapp-visible" value="visible" checked>
                                <label class="form-check-label" for="found-whatsapp-visible">
                                    Show my WhatsApp number in search results
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="found-whatsapp-visibility" id="found-whatsapp-hidden" value="hidden">
                                <label class="form-check-label" for="found-whatsapp-hidden">
                                    Only share my number when I respond to messages
                                </label>
                            </div>
                        </div>
                        
                        <!-- Registration Prompt -->
                        <div class="registration-prompt" id="found-registration-prompt" style="display: none;">
                            <h6><i class="bi bi-info-circle"></i> Registration Required</h6>
                            <p>You've chosen to only share your WhatsApp number when you respond to messages. This requires registration to use our secure messaging system.</p>
                            <button type="button" class="btn btn-primary" id="found-register-btn">
                                <i class="bi bi-person-plus"></i> Register Now
                            </button>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">Report Found Item</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="section-card" id="search-section">
            <h3 class="section-title">
                <i class="bi bi-search"></i> Search for Items
            </h3>
            <div class="row">
                <div class="col-md-8">
                    <div class="input-group">
                        <input type="text" class="form-control" id="search-input" placeholder="Enter keywords (e.g., water, keys, bag)">
                        <button class="btn btn-primary" type="button" id="search-btn">Search</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="filter-type">
                        <option value="all">All Items</option>
                        <option value="lost">Lost Items Only</option>
                        <option value="found">Found Items Only</option>
                    </select>
                </div>
            </div>
            
            <div class="loading-spinner" id="search-loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Searching for items...</p>
            </div>
            
            <div class="search-results" id="search-results"></div>
        </div>

        <!-- Secure Direct Messaging Section -->
        <div class="section-card" id="messages-section">
            <h3 class="section-title">
                <i class="bi bi-chat-dots"></i> Secure Direct Messaging
            </h3>
            <p>Communicate securely with item owners or finders without immediately exposing personal contact information.</p>
            
            <div class="messaging-section">
                <div class="messaging-header">
                    <h5>Your Conversations</h5>
                    <button class="btn btn-sm btn-primary" id="refresh-conversations-btn">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
                
                <div class="conversation-list" id="conversation-list">
                    <div class="no-conversations">
                        <i class="bi bi-chat-square-text"></i>
                        <p>No conversations yet. Start a conversation from the search results.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Safety Tips Section -->
        <div class="section-card" id="safety-section">
            <h3 class="section-title">
                <i class="bi bi-shield-check"></i> Safety Tips
            </h3>
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle-fill"></i> <strong>Important:</strong> These safety guidelines are for school safety and to prevent scams. Please follow them carefully.
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="safety-tips">
                        <h5><i class="bi bi-person-x"></i> For Lost Item Reporters</h5>
                        <ul>
                            <li>When someone contacts you claiming to have found your item, ask for specific details to verify ownership</li>
                            <li>Never share personal information beyond what is necessary</li>
                            <li>Meet in a safe, public place on campus to retrieve your item</li>
                            <li>If you suspect a scam, report the person's number to KWASU Safety Unit or contact the developer</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="safety-tips">
                        <h5><i class="bi bi-person-check"></i> For Found Item Reporters</h5>
                        <ul>
                            <li>When someone claims an item, ask for evidence of ownership (specific details, photos, etc.)</li>
                            <li>Do not return the item until you are confident about the claimant's identity</li>
                            <li>If you notice a false claim, report the person's number to KWASU Safety Unit immediately</li>
                            <li>You can also contact the developer for assistance in reporting false claimants</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="mt-3 p-3 bg-light rounded">
                <h6 class="text-center"><i class="bi bi-info-circle"></i> How to Report Suspicious Activity</h6>
                <p class="mb-0 text-center">
                    <strong>KWASU Safety Unit:</strong> Contact campus security | 
                    <strong>Developer:</strong> <a href="tel:09038323588">Rugged</a>
                </p>
            </div>
        </div>

        <!-- Simple Section Break -->
        <div class="section-break"></div>

        <!-- Top Supporters Section -->
        <div class="section-card" id="supporters-section">
            <h3 class="section-title">
                <i class="bi bi-people"></i> Top Supporters
            </h3>
            <p>We extend our heartfelt gratitude to the following individuals who supported this project:</p>
            
            <div class="supporters-section">
                <div class="particles" id="particles"></div>
                
                <div class="supporters-header">
                    <p>Meet our amazing supporters</p>
                    <div class="supporters-counter" id="supporters-counter">0</div>
                    <p>Incredible Contributors</p>
                    
                    <button class="btn toggle-supporters-btn" type="button" data-bs-toggle="collapse" data-bs-target="#supporters-list" aria-expanded="false" aria-controls="supporters-list">
                        <i class="bi bi-chevron-down"></i> <span id="toggle-text">View Supporters</span>
                    </button>
                </div>
                
                <div class="collapse mt-4" id="supporters-list">
                    <div class="supporters-grid">
                        <div class="supporter-card">
                            <div class="supporter-badge">1</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name One</div>
                            <div class="supporter-role">Project Mentor</div>
                            <div class="supporter-department">(Computer Science Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">2</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Two</div>
                            <div class="supporter-role">Technical Advisor</div>
                            <div class="supporter-department">(Mass Comm. Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">3</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Three</div>
                            <div class="supporter-role">Design Contributor</div>
                            <div class="supporter-department">(Fine Arts Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">4</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Four</div>
                            <div class="supporter-role">Content Creator</div>
                            <div class="supporter-department">(English Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">5</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Five</div>
                            <div class="supporter-role">Community Manager</div>
                            <div class="supporter-department">(Sociology Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">6</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Six</div>
                            <div class="supporter-role">Beta Tester</div>
                            <div class="supporter-department">(Mathematics Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">7</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Seven</div>
                            <div class="supporter-role">Marketing Support</div>
                            <div class="supporter-department">(Business Admin Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">8</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Eight</div>
                            <div class="supporter-role">Documentation</div>
                            <div class="supporter-department">(Library Science Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">9</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Nine</div>
                            <div class="supporter-role">Feedback Provider</div>
                            <div class="supporter-department">(Psychology Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">10</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Ten</div>
                            <div class="supporter-role">Evangelist</div>
                            <div class="supporter-department">(Political Science Dpt.)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 KWASU Lost & Found Portal. Designed & Developed by Rugged of ICT.</p>
            <p>For support: <a href="tel:09038323588">09038323588</a></p>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Report Details Modal -->
    <div class="modal fade report-details-modal" id="reportDetailsModal" tabindex="-1" aria-labelledby="reportDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportDetailsModalLabel">Report Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="reportDetailsContent">
                        <!-- Report details will be inserted here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Copy Tooltip -->
    <div class="copy-tooltip" id="copyTooltip">Copied to clipboard!</div>

    <!-- Matching Items Modal -->
    <div class="modal fade" id="matchingItemsModal" tabindex="-1" aria-labelledby="matchingItemsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="matchingItemsModalLabel">Matching Found Items</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="matchingItemsContent">
                        <!-- Matching items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal for Found Items -->
    <div class="modal fade" id="verificationModal" tabindex="-1" aria-labelledby="verificationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="verificationModalLabel">Verify Item Claim</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>To verify that you are the original reporter of this found item, please enter the verification code that was sent to your WhatsApp number when you first reported the item.</p>
                    
                    <div class="verification-input-group">
                        <label for="verification-code-input" class="form-label">Enter Verification Code:</label>
                        <input type="text" class="form-control verification-input" id="verification-code-input" placeholder="Enter your 6-character code" maxlength="6">
                    </div>
                    
                    <p class="forgot-code-tip">
                        <i class="bi bi-info-circle"></i> If you forgot your verification code, please contact the developer at <a href="tel:09038323588">09038323588</a>
                    </p>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="button" class="btn btn-primary" id="confirmClaimBtn">Confirm and Mark as Claimed</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal for Lost Items -->
    <div class="modal fade lost-verification-modal" id="lostVerificationModal" tabindex="-1" aria-labelledby="lostVerificationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="lostVerificationModalLabel">Verify Item Recovery</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body lost-verification-modal">
                    <div class="modal-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <p>To verify that you are the original reporter of this lost item, please enter the verification code that was generated when you first reported the item.</p>
                    
                    <div class="verification-input-group">
                        <label for="lost-verification-code-input" class="form-label">Enter Verification Code:</label>
                        <input type="text" class="form-control verification-input" id="lost-verification-code-input" placeholder="Enter your 6-character code" maxlength="6">
                    </div>
                    
                    <p class="forgot-code-tip">
                        <i class="bi bi-info-circle"></i> If you forgot your verification code, please contact the developer at <a href="tel:09038323588">09038323588</a>
                    </p>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="button" class="btn btn-primary" id="confirmRecoveredBtn">Confirm and Mark as Recovered</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Founder Details Modal -->
    <div class="modal fade" id="founderDetailsModal" tabindex="-1" aria-labelledby="founderDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="founderDetailsModalLabel">Founder Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="founderDetailsContent">
                        <!-- Founder details will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal fade message-modal" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageModalLabel">Conversation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="message-contact-card" id="message-contact-card">
                        <!-- Contact information will be inserted here -->
                    </div>
                    <div class="message-container" id="message-container">
                        <!-- Messages will be loaded here -->
                    </div>
                    <div class="message-input-container">
                        <textarea class="form-control message-input" id="message-input" placeholder="Type your message here..." rows="2"></textarea>
                        
                        <!-- Image Upload -->
                        <div class="image-upload-container">
                            <label for="image-upload" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-image"></i> Add Image
                            </label>
                            <input type="file" id="image-upload" accept="image/*" style="display: none;">
                            <img class="image-preview" id="image-preview" alt="Image preview">
                        </div>
                        
                        <!-- Contact Details -->
                        <div class="contact-details-container" id="contact-details-container">
                            <div class="contact-detail-item">
                                <div class="contact-detail-label">Name:</div>
                                <div class="contact-detail-value" id="contact-name-value"></div>
                            </div>
                            <div class="contact-detail-item">
                                <div class="contact-detail-label">Email:</div>
                                <div class="contact-detail-value" id="contact-email-value"></div>
                            </div>
                            <div class="contact-detail-item">
                                <div class="contact-detail-label">Phone:</div>
                                <div class="contact-detail-value" id="contact-phone-value"></div>
                            </div>
                        </div>
                        
                        <div class="message-actions">
                            <div>
                                <button type="button" class="share-info-btn" id="share-contact-btn">
                                    <i class="bi bi-share"></i> Share Contact Info
                                </button>
                                <button type="button" class="report-conversation-btn" id="report-conversation-btn">
                                    <i class="bi bi-exclamation-triangle"></i> Report
                                </button>
                            </div>
                            <button type="button" class="btn btn-primary" id="send-message-btn">
                                <i class="bi bi-send"></i> Send
                            </button>
                        </div>
                        <div class="message-safety-tips" id="message-safety-tips">
                            <i class="bi bi-shield-exclamation"></i> <strong>Safety Tip:</strong> Do not share personal information until you have verified the other person's identity.
                        </div>
                        <div class="message-info-shared" id="message-info-shared" style="display: none;">
                            <i class="bi bi-check-circle"></i> You have shared your contact information with this user.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Conversation Modal -->
    <div class="modal fade" id="reportConversationModal" tabindex="-1" aria-labelledby="reportConversationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportConversationModalLabel">Report Conversation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Please provide details about why you are reporting this conversation:</p>
                    <div class="mb-3">
                        <label for="report-reason" class="form-label">Reason for Reporting</label>
                        <select class="form-select" id="report-reason">
                            <option value="">Select a reason</option>
                            <option value="spam">Spam or unwanted messages</option>
                            <option value="harassment">Harassment or abusive behavior</option>
                            <option value="scam">Suspected scam or fraud</option>
                            <option value="inappropriate">Inappropriate content</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="report-details" class="form-label">Additional Details</label>
                        <textarea class="form-control" id="report-details" rows="3" placeholder="Please provide more details about the issue..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="submit-report-btn">Submit Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration/Login Modal -->
    <div class="modal fade auth-modal" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalLabel">Welcome to KWASU Lost & Found</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="auth-tabs">
                        <div class="auth-tab active" id="login-tab">Login</div>
                        <div class="auth-tab" id="register-tab">Register</div>
                    </div>
                    
                    <!-- Login Form -->
                    <div class="auth-content active" id="login-content">
                        <form id="login-form">
                            <div class="mb-3">
                                <label for="login-email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="login-email" placeholder="Enter your email" required>
                            </div>
                            <div class="mb-3">
                                <label for="login-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="login-password" placeholder="Enter your password" required>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Login</button>
                            </div>
                            <div class="text-center mt-3">
                                <a href="#" id="forgot-password-link">Forgot Password?</a>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Registration Form -->
                    <div class="auth-content" id="register-content">
                        <form id="register-form">
                            <div class="mb-3">
                                <label for="register-name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="register-name" placeholder="Enter your full name" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="register-email" placeholder="Enter your email" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-phone" class="form-label">WhatsApp Number</label>
                                <input type="tel" class="form-control" id="register-phone" placeholder="Enter your WhatsApp number" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="register-password" placeholder="Create a password" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-confirm-password" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="register-confirm-password" placeholder="Confirm your password" required>
                            </div>
                            
                            <!-- Notification Settings -->
                            <div class="notification-settings">
                                <h6>Notification Preferences</h6>
                                <div class="notification-setting">
                                    <span>Email Notifications</span>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email-notifications" checked>
                                    </div>
                                </div>
                                <div class="notification-setting">
                                    <span>Browser Push Notifications</span>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="push-notifications" checked>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 mt-3">
                                <button type="submit" class="btn btn-primary">Register</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Verification Code Input -->
                    <div class="verification-input-group" id="verification-input-group">
                        <p>We've sent a verification code to your email and WhatsApp number. Please enter it below:</p>
                        <div class="mb-3">
                            <label for="verification-code" class="form-label">Verification Code</label>
                            <input type="text" class="form-control" id="verification-code" placeholder="Enter verification code" required>
                        </div>
                        <div class="verification-method">
                            <button type="button" class="btn btn-outline-secondary" id="resend-email-code">Resend Email</button>
                            <button type="button" class="btn btn-outline-secondary" id="resend-whatsapp-code">Resend WhatsApp</button>
                        </div>
                        <div class="d-grid gap-2 mt-3">
                            <button type="button" class="btn btn-primary" id="verify-code-btn">Verify</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-messaging-compat.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCQoQ2mVg7vI8sQJ4R1XJzJ6v7K8l9m0n1o",
            authDomain: "kwasu-lost-and-found.firebaseapp.com",
            databaseURL: "https://kwasu-lost-and-found-default-rtdb.firebaseio.com",
            projectId: "kwasu-lost-and-found",
            storageBucket: "kwasu-lost-and-found.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456789012345"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        const messaging = firebase.messaging();
        
        // DOM Elements
        const menuToggle = document.getElementById('menu-toggle');
        const navMenu = document.getElementById('nav-menu');
        const navLogin = document.getElementById('nav-login');
        const navRegister = document.getElementById('nav-register');
        const userAvatar = document.getElementById('user-avatar');
        const notificationContainer = document.getElementById('notification-container');
        const notificationBtn = document.getElementById('notification-btn');
        const notificationCount = document.getElementById('notification-count');
        const notificationPanel = document.getElementById('notification-panel');
        const notificationList = document.getElementById('notification-list');
        const clearNotificationsBtn = document.getElementById('clear-notifications');
        
        const lostItemForm = document.getElementById('lost-item-form');
        const foundItemForm = document.getElementById('found-item-form');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const filterType = document.getElementById('filter-type');
        const searchResults = document.getElementById('search-results');
        const searchLoading = document.getElementById('search-loading');
        const toastContainer = document.querySelector('.toast-container');
        const toggleText = document.getElementById('toggle-text');
        const supportersList = document.getElementById('supporters-list');
        const supportersCounter = document.getElementById('supporters-counter');
        const particles = document.getElementById('particles');
        const matchingItemsModal = new bootstrap.Modal(document.getElementById('matchingItemsModal'));
        const matchingItemsContent = document.getElementById('matchingItemsContent');
        const verificationModal = new bootstrap.Modal(document.getElementById('verificationModal'));
        const verificationCodeInput = document.getElementById('verification-code-input');
        const confirmClaimBtn = document.getElementById('confirmClaimBtn');
        const lostVerificationModal = new bootstrap.Modal(document.getElementById('lostVerificationModal'));
        const lostVerificationCodeInput = document.getElementById('lost-verification-code-input');
        const confirmRecoveredBtn = document.getElementById('confirmRecoveredBtn');
        const founderDetailsModal = new bootstrap.Modal(document.getElementById('founderDetailsModal'));
        const founderDetailsContent = document.getElementById('founderDetailsContent');
        const reportDetailsModal = new bootstrap.Modal(document.getElementById('reportDetailsModal'));
        const reportDetailsContent = document.getElementById('reportDetailsContent');
        const copyTooltip = document.getElementById('copy-tooltip');
        
        // Registration Prompt Elements
        const lostRegistrationPrompt = document.getElementById('lost-registration-prompt');
        const foundRegistrationPrompt = document.getElementById('found-registration-prompt');
        const lostRegisterBtn = document.getElementById('lost-register-btn');
        const foundRegisterBtn = document.getElementById('found-register-btn');
        
        // Messaging System Elements
        const conversationList = document.getElementById('conversation-list');
        const refreshConversationsBtn = document.getElementById('refresh-conversations-btn');
        const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));
        const messageModalLabel = document.getElementById('messageModalLabel');
        const messageContactCard = document.getElementById('message-contact-card');
        const messageContainer = document.getElementById('message-container');
        const messageInput = document.getElementById('message-input');
        const sendMessageBtn = document.getElementById('send-message-btn');
        const shareContactBtn = document.getElementById('share-contact-btn');
        const reportConversationBtn = document.getElementById('report-conversation-btn');
        const messageSafetyTips = document.getElementById('message-safety-tips');
        const messageInfoShared = document.getElementById('message-info-shared');
        const reportConversationModal = new bootstrap.Modal(document.getElementById('reportConversationModal'));
        const reportReason = document.getElementById('report-reason');
        const reportDetails = document.getElementById('report-details');
        const submitReportBtn = document.getElementById('submit-report-btn');
        
        // Image Upload Elements
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        
        // Contact Details Elements
        const contactDetailsContainer = document.getElementById('contact-details-container');
        const contactNameValue = document.getElementById('contact-name-value');
        const contactEmailValue = document.getElementById('contact-email-value');
        const contactPhoneValue = document.getElementById('contact-phone-value');
        
        // Auth Modal Elements
        const authModal = new bootstrap.Modal(document.getElementById('authModal'));
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const loginContent = document.getElementById('login-content');
        const registerContent = document.getElementById('register-content');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const verificationInputGroup = document.getElementById('verification-input-group');
        const verificationCode = document.getElementById('verification-code');
        const verifyCodeBtn = document.getElementById('verify-code-btn');
        const resendEmailCode = document.getElementById('resend-email-code');
        const resendWhatsAppCode = document.getElementById('resend-whatsapp-code');
        const emailNotifications = document.getElementById('email-notifications');
        const pushNotifications = document.getElementById('push-notifications');
        
        // Navigation Elements
        const navHome = document.getElementById('nav-home');
        const navReportLost = document.getElementById('nav-report-lost');
        const navReportFound = document.getElementById('nav-report-found');
        const navSearch = document.getElementById('nav-search');
        const navMessages = document.getElementById('nav-messages');
        const navSafety = document.getElementById('nav-safety');
        const navSupporters = document.getElementById('nav-supporters');
        
        // Global variables
        let currentItemToClaim = null;
        let currentItemToRecover = null;
        let matchingFoundItems = [];
        let lastReportData = null;
        let currentConversation = null;
        let currentMessages = [];
        let contactInfoShared = {};
        let currentUser = null;
        let notifications = [];
        let unreadNotifications = 0;
        let uploadedImage = null;
        let contactDetails = {
            name: '',
            email: '',
            phone: ''
        };
        
        // Create floating particles
        function createParticles() {
            const particleCount = 20;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 5 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animation = 'float linear infinite';
                
                particles.appendChild(particle);
            }
        }
        
        // Generate random verification code
        function generateVerificationCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        // Generate conversation ID
        function generateConversationId(reportId1, reportId2) {
            // Sort the IDs to ensure consistent conversation ID regardless of who initiates
            const sortedIds = [reportId1, reportId2].sort();
            return sortedIds.join('_');
        }
        
        // Toggle mobile menu
        menuToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.nav-menu a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });
        
        // Navigation scroll to section
        navHome.addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        navReportLost.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('report-lost-section').scrollIntoView({ behavior: 'smooth' });
        });
        
        navReportFound.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('report-found-section').scrollIntoView({ behavior: 'smooth' });
        });
        
        navSearch.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('search-section').scrollIntoView({ behavior: 'smooth' });
        });
        
        navMessages.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('messages-section').scrollIntoView({ behavior: 'smooth' });
        });
        
        navSafety.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('safety-section').scrollIntoView({ behavior: 'smooth' });
        });
        
        navSupporters.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('supporters-section').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Auth Modal Tabs
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginContent.classList.add('active');
            registerContent.classList.remove('active');
            verificationInputGroup.classList.remove('active');
        });
        
        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerContent.classList.add('active');
            loginContent.classList.remove('active');
            verificationInputGroup.classList.remove('active');
        });
        
        // Login/Register Buttons in Menu
        navLogin.addEventListener('click', (e) => {
            e.preventDefault();
            authModal.show();
            loginTab.click();
        });
        
        navRegister.addEventListener('click', (e) => {
            e.preventDefault();
            authModal.show();
            registerTab.click();
        });
        
        // Login Form
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                // For demo purposes, we'll simulate login
                // In a real implementation, you would use Firebase Auth
                console.log('Login attempt:', { email, password });
                
                // Simulate successful login
                showToast('Login successful!', 'success');
                authModal.hide();
                
                // Update UI to show logged in state
                updateUserUI();
            } catch (error) {
                console.error('Error logging in:', error);
                showToast('Failed to login. Please check your credentials.', 'error');
            }
        });
        
        // Register Form
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match.', 'error');
                return;
            }
            
            try {
                // For demo purposes, we'll simulate registration
                // In a real implementation, you would use Firebase Auth
                console.log('Registration attempt:', { name, email, phone, password });
                
                // Generate verification code
                const verificationCode = generateVerificationCode();
                
                // Show verification input
                loginContent.classList.remove('active');
                registerContent.classList.remove('active');
                verificationInputGroup.classList.add('active');
                
                showToast('Registration successful! Please check your email and WhatsApp for the verification code.', 'success');
            } catch (error) {
                console.error('Error registering:', error);
                showToast('Failed to register. Please try again.', 'error');
            }
        });
        
        // Verify Code
        verifyCodeBtn.addEventListener('click', async () => {
            const code = verificationCode.value.trim();
            
            if (!code) {
                showToast('Please enter the verification code.', 'error');
                return;
            }
            
            try {
                // For demo purposes, we'll simulate verification
                console.log('Verification attempt:', code);
                
                // Simulate successful verification
                showToast('Account verified successfully!', 'success');
                authModal.hide();
                
                // Update UI to show logged in state
                updateUserUI();
            } catch (error) {
                console.error('Error verifying code:', error);
                showToast('Failed to verify code. Please try again.', 'error');
            }
        });
        
        // Resend Email Code
        resendEmailCode.addEventListener('click', async () => {
            try {
                // For demo purposes, we'll simulate resending email code
                console.log('Resend email code');
                
                showToast('Verification code resent to your email.', 'success');
            } catch (error) {
                console.error('Error resending email code:', error);
                showToast('Failed to resend verification code.', 'error');
            }
        });
        
        // Resend WhatsApp Code
        resendWhatsAppCode.addEventListener('click', async () => {
            try {
                // For demo purposes, we'll simulate resending WhatsApp code
                console.log('Resend WhatsApp code');
                
                showToast('Verification code resent to your WhatsApp.', 'success');
            } catch (error) {
                console.error('Error resending WhatsApp code:', error);
                showToast('Failed to resend verification code.', 'error');
            }
        });
        
        // Update user UI
        function updateUserUI() {
            // For demo purposes, we'll simulate a logged in user
            currentUser = {
                uid: 'demo-user-id',
                name: 'Demo User',
                email: 'demo@example.com',
                phone: '08012345678'
            };
            
            // Show user avatar and notifications
            userAvatar.style.display = 'flex';
            notificationContainer.style.display = 'block';
            
            // Set user avatar initials
            const initials = currentUser.name ? currentUser.name.substring(0, 2).toUpperCase() : 'U';
            userAvatar.innerHTML = initials;
            
            // Load conversations
            loadConversations();
        }
        
        // Request notification permission
        async function requestNotificationPermission() {
            try {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    
                    if (permission === 'granted') {
                        // Get FCM token
                        const token = await messaging.getToken();
                        
                        if (token) {
                            // Save FCM token to database
                            console.log('FCM Token:', token);
                        }
                    }
                }
            } catch (error) {
                console.error('Error requesting notification permission:', error);
            }
        }
        
        // Load notifications
        async function loadNotifications() {
            // For demo purposes, we'll simulate loading notifications
            notifications = [];
            unreadNotifications = 0;
            
            // Update notification count
            notificationCount.textContent = unreadNotifications;
            notificationCount.style.display = unreadNotifications > 0 ? 'block' : 'none';
            
            // Update notification list
            updateNotificationList();
        }
        
        // Update notification list
        function updateNotificationList() {
            if (notifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="no-notifications">
                        <i class="bi bi-bell-slash"></i>
                        <p>No notifications</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            notifications.forEach(notification => {
                const date = new Date(notification.timestamp);
                const formattedTime = date.toLocaleString();
                
                html += `
                    <div class="notification-item ${notification.read ? '' : 'unread'}" data-id="${notification.id}">
                        <div>${notification.message}</div>
                        <div class="notification-time">${formattedTime}</div>
                    </div>
                `;
            });
            
            notificationList.innerHTML = html;
            
            // Add click event to notification items
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', async function() {
                    const notificationId = this.getAttribute('data-id');
                    
                    // Mark notification as read
                    this.classList.remove('unread');
                    
                    // Close notification panel
                    notificationPanel.classList.remove('show');
                });
            });
        }
        
        // Toggle notification panel
        notificationBtn.addEventListener('click', () => {
            notificationPanel.classList.toggle('show');
        });
        
        // Clear notifications
        clearNotificationsBtn.addEventListener('click', async () => {
            // For demo purposes, we'll simulate clearing notifications
            notifications = [];
            unreadNotifications = 0;
            
            // Update notification count
            notificationCount.textContent = unreadNotifications;
            notificationCount.style.display = unreadNotifications > 0 ? 'block' : 'none';
            
            // Update notification list
            updateNotificationList();
        });
        
        // Close notification panel when clicking outside
        document.addEventListener('click', (e) => {
            if (!notificationPanel.contains(e.target) && 
                !notificationBtn.contains(e.target) && 
                notificationPanel.classList.contains('show')) {
                notificationPanel.classList.remove('show');
            }
        });
        
        // Animate counter
        function animateCounter(target, duration = 2000) {
            let start = 0;
            const increment = target / (duration / 16);
            
            const timer = setInterval(() => {
                start += increment;
                if (start >= target) {
                    supportersCounter.textContent = target;
                    clearInterval(timer);
                } else {
                    supportersCounter.textContent = Math.floor(start);
                }
            }, 16);
        }
        
        // Toggle Supporters List
        supportersList.addEventListener('show.bs.collapse', function () {
            toggleText.textContent = 'Hide Supporters';
            animateCounter(10);
        });
        
        supportersList.addEventListener('hide.bs.collapse', function () {
            toggleText.textContent = 'View Supporters';
            supportersCounter.textContent = '0';
        });
        
        // Show toast notification with action button
        function showToast(message, type = 'success', actionButton = null) {
            const toastId = 'toast-' + Date.now();
            const toastHtml = `
                <div id="${toastId}" class="toast toast-${type}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <i class="bi bi-${type === 'success' ? 'check-circle-fill text-success' : 'exclamation-triangle-fill text-danger'} me-2"></i>
                        <strong class="me-auto">KWASU Lost & Found</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                        ${actionButton ? `<button type="button" class="btn btn-sm btn-primary mt-2 toast-action-btn">${actionButton.text}</button>` : ''}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { autohide: false }); // Disable auto-hide
            toast.show();
            
            // Add click event if action button is provided
            if (actionButton) {
                const actionBtn = toastElement.querySelector('.toast-action-btn');
                actionBtn.addEventListener('click', () => {
                    actionButton.callback();
                    toast.hide();
                });
            }
            
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }
        
        // Show report details modal
        function showReportDetailsModal(reportData) {
            let html = '';
            
            if (reportData.type === 'lost') {
                html = `
                    <div class="report-details-card">
                        <h5><i class="bi bi-search"></i> Lost Item Details</h5>
                        <div class="detail-row">
                            <div class="detail-label">Item Name:</div>
                            <div class="detail-value">${reportData.item}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Location:</div>
                            <div class="detail-value">${reportData.location}</div>
                        </div>
                        ${reportData.last_seen ? `
                        <div class="detail-row">
                            <div class="detail-label">Last Seen:</div>
                            <div class="detail-value">${reportData.last_seen}</div>
                        </div>
                        ` : ''}
                        <div class="detail-row">
                            <div class="detail-label">Description:</div>
                            <div class="detail-value">${reportData.description}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact:</div>
                            <div class="detail-value">${reportData.contact_info}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Verification Code:</div>
                            <div class="detail-value">
                                <div class="verification-code-box" id="lostReportVerificationCode">
                                    ${reportData.verification_code}
                                </div>
                                <small class="text-muted">Click to copy</small>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported On:</div>
                            <div class="detail-value">${new Date(reportData.timestamp).toLocaleString()}</div>
                        </div>
                        
                        <div class="importance-note">
                            <h6><i class="bi bi-exclamation-triangle-fill"></i> Why You Need to Save This Code</h6>
                            <p>This verification code is your proof that you reported this lost item. You will need it to:</p>
                            <ul>
                                <li>Verify your identity when marking the item as recovered</li>
                                <li>Prevent unauthorized users from marking your item as recovered</li>
                                <li>Ensure the security and integrity of your report</li>
                            </ul>
                            <p class="mb-0"><strong>Please save this code by taking a screenshot or writing it down!</strong></p>
                        </div>
                        
                        <div class="guide-section">
                            <h6><i class="bi bi-list-ol"></i> How to Mark Your Item as Recovered</h6>
                            <p>After you've recovered your lost item, please follow these steps to mark it as recovered:</p>
                            <ol>
                                <li>Return to this website (KWASU Lost & Found Portal)</li>
                                <li>Scroll down to the search section</li>
                                <li>Search for the item you reported using keywords</li>
                                <li>Find your reported item in the search results</li>
                                <li>Click the "Mark as Recovered" button</li>
                                <li>Enter your verification code when prompted</li>
                                <li>Confirm to mark the item as recovered</li>
                            </ol>
                            
                            <h6 class="mt-3"><i class="bi bi-heart-fill text-danger"></i> Why This Is Important</h6>
                            <p>Marking items as recovered helps keep our database clean and prevents confusion for other users. It also helps us track the success of this portal in reuniting lost items with their owners.</p>
                        </div>
                        
                        <div class="safety-alert">
                            <h6><i class="bi bi-shield-exclamation"></i> Safety Tips for Lost Item Reporters</h6>
                            <p>When someone contacts you claiming to have found your item:</p>
                            <ul>
                                <li>Ask for specific details about the item to verify ownership</li>
                                <li>Never share personal information beyond what is necessary</li>
                                <li>Meet in a safe, public place on campus to retrieve your item</li>
                                <li>If you suspect a scam, report the person's number to KWASU Safety Unit or contact the developer at 09038323588</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else if (reportData.type === 'found') {
                html = `
                    <div class="report-details-card">
                        <h5><i class="bi bi-gift"></i> Found Item Details</h5>
                        <div class="detail-row">
                            <div class="detail-label">Item Name:</div>
                            <div class="detail-value">${reportData.item}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Location:</div>
                            <div class="detail-value">${reportData.location}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact:</div>
                            <div class="detail-value">${reportData.contact_phone}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Verification Code:</div>
                            <div class="detail-value">
                                <div class="verification-code-box" id="foundReportVerificationCode">
                                    ${reportData.verification_code}
                                </div>
                                <small class="text-muted">Click to copy</small>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported On:</div>
                            <div class="detail-value">${new Date(reportData.timestamp).toLocaleString()}</div>
                        </div>
                        
                        <div class="importance-note">
                            <h6><i class="bi bi-exclamation-triangle-fill"></i> Why You Need to Save This Code</h6>
                            <p>This verification code is your proof that you reported this item. You will need it to:</p>
                            <ul>
                                <li>Verify your identity when someone claims this item</li>
                                <li>Mark the item as claimed after returning it to the owner</li>
                                <li>Prevent false claims and scams</li>
                            </ul>
                            <p class="mb-0"><strong>Please save this code by taking a screenshot or writing it down!</strong></p>
                        </div>
                        
                        <div class="guide-section">
                            <h6><i class="bi bi-list-ol"></i> How to Mark Item as Claimed After Returning to Owner</h6>
                            <p>After you've returned the item to its rightful owner, please follow these steps to mark it as claimed:</p>
                            <ol>
                                <li>Return to this website (KWASU Lost & Found Portal)</li>
                                <li>Scroll down to the search section</li>
                                <li>Search for the item you reported using keywords</li>
                                <li>Find your reported item in the search results</li>
                                <li>Click the "Mark as Claimed" button</li>
                                <li>Enter your verification code when prompted</li>
                                <li>Confirm to mark the item as claimed</li>
                            </ol>
                            
                            <h6 class="mt-3"><i class="bi bi-heart-fill text-danger"></i> Why This Is Important</h6>
                            <p>Marking items as claimed helps keep our database clean and prevents confusion for other users. It also helps us track the success of this portal in reuniting lost items with their owners.</p>
                        </div>
                        
                        <div class="safety-alert">
                            <h6><i class="bi bi-shield-exclamation"></i> Important Safety Information</h6>
                            <p>When someone claims this item:</p>
                            <ul>
                                <li>Ask for specific details about the item to verify ownership</li>
                                <li>Do not return the item until you are confident about the claimant's identity</li>
                                <li>If you notice a false claim, report the person's number to KWASU Safety Unit immediately</li>
                                <li>You can also contact the developer for assistance in reporting false claimants</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            reportDetailsContent.innerHTML = html;
            reportDetailsModal.show();
            
            // Add click event to verification code to copy to clipboard
            const codeElementId = reportData.type === 'lost' ? 'lostReportVerificationCode' : 'foundReportVerificationCode';
            const codeElement = document.getElementById(codeElementId);
            if (codeElement) {
                codeElement.addEventListener('click', (e) => {
                    const code = reportData.verification_code;
                    navigator.clipboard.writeText(code).then(() => {
                        // Show tooltip
                        copyTooltip.style.left = e.pageX + 'px';
                        copyTooltip.style.top = (e.pageY - 30) + 'px';
                        copyTooltip.classList.add('show');
                        
                        setTimeout(() => {
                            copyTooltip.classList.remove('show');
                        }, 2000);
                    }).catch(err => {
                        console.error('Could not copy text: ', err);
                        showToast('Failed to copy verification code.', 'error');
                    });
                });
            }
        }
        
        // Show matching items modal
        function showMatchingItemsModal(matchingItems) {
            let html = '';
            
            matchingItems.forEach((item, index) => {
                const date = new Date(item.timestamp).toLocaleString();
                html += `
                    <div class="matching-item-card">
                        <h5>Matching Item #${index + 1}</h5>
                        <div class="detail-row">
                            <div class="detail-label">Item Name:</div>
                            <div class="detail-value">${item.item}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Found At:</div>
                            <div class="detail-value">${item.location}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported On:</div>
                            <div class="detail-value">${date}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact:</div>
                            <div class="detail-value">
                                <a href="https://wa.me/${item.contact_phone.replace(/^0/, '234')}" target="_blank" class="contact-btn">
                                    <i class="bi bi-whatsapp"></i> WhatsApp: ${item.contact_phone}
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            matchingItemsContent.innerHTML = html;
            matchingItemsModal.show();
        }
        
        // Load conversations
        async function loadConversations() {
            if (!currentUser) {
                conversationList.innerHTML = `
                    <div class="no-conversations">
                        <i class="bi bi-chat-square-text"></i>
                        <p>Please login to view your conversations.</p>
                    </div>
                `;
                return;
            }
            
            // For demo purposes, we'll simulate loading conversations
            conversationList.innerHTML = `
                <div class="no-conversations">
                    <i class="bi bi-chat-square-text"></i>
                    <p>No conversations yet. Start a conversation from the search results.</p>
                </div>
            `;
        }
        
        // Open conversation
        async function openConversation(conversationId) {
            if (!currentUser) {
                showToast('Please login to view conversations.', 'error');
                authModal.show();
                registerTab.click();
                return;
            }
            
            // For demo purposes, we'll simulate opening a conversation
            currentConversation = conversationId;
            
            // Set modal title
            messageModalLabel.textContent = 'Conversation about Demo Item';
            
            // Set contact card
            messageContactCard.innerHTML = `
                <div class="message-contact-header">
                    <div class="message-contact-avatar">DI</div>
                    <div class="message-contact-info">
                        <div class="message-contact-name">Demo Item</div>
                        <div class="message-contact-item">Found Item Reporter</div>
                        <div class="message-contact-item">Location: Demo Location</div>
                        <div class="message-status message-verification-pending">
                            <i class="bi bi-shield-exclamation"></i> Anonymous - No contact information shared yet
                        </div>
                    </div>
                </div>
            `;
            
            // Load messages
            currentMessages = [];
            
            // Display messages
            displayMessages();
            
            // Show modal
            messageModal.show();
            
            // Focus on message input
            setTimeout(() => {
                messageInput.focus();
            }, 500);
        }
        
        // Display messages in the conversation
        function displayMessages() {
            let html = '';
            
            if (currentMessages.length === 0) {
                html = `
                    <div class="no-conversations">
                        <i class="bi bi-chat-dots"></i>
                        <p>No messages yet. Start the conversation!</p>
                    </div>
                `;
            } else {
                currentMessages.forEach(message => {
                    const isSent = message.sender_id === currentUser.uid;
                    const date = new Date(message.timestamp);
                    const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    
                    if (message.type === 'image') {
                        html += `
                            <div class="message ${isSent ? 'message-sent' : 'message-received'}">
                                <div>
                                    <img src="${message.text}" alt="Shared image" class="message-image">
                                </div>
                                <div class="message-time">${formattedTime}</div>
                            </div>
                        `;
                    } else if (message.type === 'contact') {
                        const contactData = JSON.parse(message.text);
                        html += `
                            <div class="message ${isSent ? 'message-sent' : 'message-received'}">
                                <div>
                                    <div class="contact-details-container show">
                                        <div class="contact-detail-item">
                                            <div class="contact-detail-label">Name:</div>
                                            <div class="contact-detail-value">${contactData.name}</div>
                                        </div>
                                        <div class="contact-detail-item">
                                            <div class="contact-detail-label">Email:</div>
                                            <div class="contact-detail-value">${contactData.email}</div>
                                        </div>
                                        <div class="contact-detail-item">
                                            <div class="contact-detail-label">Phone:</div>
                                            <div class="contact-detail-value">${contactData.phone}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="message-time">${formattedTime}</div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="message ${isSent ? 'message-sent' : 'message-received'}">
                                <div>${message.text}</div>
                                <div class="message-time">${formattedTime}</div>
                            </div>
                        `;
                    }
                });
            }
            
            messageContainer.innerHTML = html;
            
            // Scroll to bottom
            messageContainer.scrollTop = messageContainer.scrollHeight;
            
            // Add click event to images
            document.querySelectorAll('.message-image').forEach(img => {
                img.addEventListener('click', function() {
                    window.open(this.src, '_blank');
                });
            });
        }
        
        // Send message
        async function sendMessage() {
            const text = messageInput.value.trim();
            
            if (!text || !currentConversation || !currentUser) {
                return;
            }
            
            try {
                // For demo purposes, we'll simulate sending a message
                const messageData = {
                    sender_id: currentUser.uid,
                    text: text,
                    timestamp: new Date().toISOString(),
                    read: false,
                    type: 'text'
                };
                
                // Add message to current messages array
                currentMessages.push({
                    id: 'demo-message-id',
                    ...messageData
                });
                
                // Clear input and refresh display
                messageInput.value = '';
                displayMessages();
                
                showToast('Message sent successfully!', 'success');
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Failed to send message. Please try again.', 'error');
            }
        }
        
        // Share contact information
        async function shareContactInfo() {
            if (!currentConversation || !currentUser) {
                return;
            }
            
            try {
                // Send contact info as a message
                const contactData = {
                    name: currentUser.name,
                    email: currentUser.email,
                    phone: currentUser.phone
                };
                
                const messageData = {
                    sender_id: currentUser.uid,
                    text: JSON.stringify(contactData),
                    timestamp: new Date().toISOString(),
                    read: false,
                    type: 'contact'
                };
                
                // Add message to current messages array
                currentMessages.push({
                    id: 'demo-message-id',
                    ...messageData
                });
                
                // Mark contact info as shared
                contactInfoShared[currentConversation] = true;
                
                // Update UI
                messageSafetyTips.style.display = 'none';
                messageInfoShared.style.display = 'block';
                
                // Update contact status
                const statusElement = messageContactCard.querySelector('.message-status');
                if (statusElement) {
                    statusElement.className = 'message-status message-verification-complete';
                    statusElement.innerHTML = '<i class="bi bi-check-circle-fill"></i> Contact information shared';
                }
                
                // Refresh display
                displayMessages();
                
                // Show confirmation
                showToast('Your contact information has been shared securely.', 'success');
            } catch (error) {
                console.error('Error sharing contact info:', error);
                showToast('Failed to share contact information. Please try again.', 'error');
            }
        }
        
        // Report conversation
        function reportConversation() {
            reportReason.value = '';
            reportDetails.value = '';
            reportConversationModal.show();
        }
        
        // Submit report
        async function submitReport() {
            const reason = reportReason.value;
            const details = reportDetails.value.trim();
            
            if (!reason) {
                showToast('Please select a reason for reporting.', 'error');
                return;
            }
            
            try {
                // For demo purposes, we'll simulate submitting a report
                console.log('Report submitted:', { reason, details });
                
                reportConversationModal.hide();
                messageModal.hide();
                
                showToast('Your report has been submitted. Thank you for helping keep our community safe.', 'success');
            } catch (error) {
                console.error('Error submitting report:', error);
                showToast('Failed to submit report. Please try again.', 'error');
            }
        }
        
        // Start a new conversation
        async function startConversation(reportId1, reportId2) {
            if (!currentUser) {
                showToast('Please login to start a conversation.', 'error');
                authModal.show();
                registerTab.click();
                return;
            }
            
            try {
                // Generate conversation ID
                const conversationId = generateConversationId(reportId1, reportId2);
                
                // Open conversation
                openConversation(conversationId);
            } catch (error) {
                console.error('Error starting conversation:', error);
                showToast('Failed to start conversation. Please try again.', 'error');
            }
        }
        
        // Image upload
        imageUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    uploadedImage = e.target.result;
                    imagePreview.src = uploadedImage;
                    imagePreview.classList.add('show');
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        // WhatsApp visibility change handlers
        document.getElementById('lost-whatsapp-visible').addEventListener('change', function() {
            if (this.checked) {
                lostRegistrationPrompt.style.display = 'none';
            }
        });
        
        document.getElementById('lost-whatsapp-hidden').addEventListener('change', function() {
            if (this.checked) {
                lostRegistrationPrompt.style.display = 'block';
            }
        });
        
        document.getElementById('found-whatsapp-visible').addEventListener('change', function() {
            if (this.checked) {
                foundRegistrationPrompt.style.display = 'none';
            }
        });
        
        document.getElementById('found-whatsapp-hidden').addEventListener('change', function() {
            if (this.checked) {
                foundRegistrationPrompt.style.display = 'block';
            }
        });
        
        // Registration prompt buttons
        lostRegisterBtn.addEventListener('click', () => {
            authModal.show();
            registerTab.click();
        });
        
        foundRegisterBtn.addEventListener('click', () => {
            authModal.show();
            registerTab.click();
        });
        
        // Report Lost Item
        lostItemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const item = document.getElementById('lost-item').value;
            const location = document.getElementById('lost-location').value;
            const lastSeen = document.getElementById('lost-last-seen').value;
            const description = document.getElementById('lost-description').value;
            const contact = document.getElementById('lost-contact').value;
            const whatsappVisibility = document.querySelector('input[name="lost-whatsapp-visibility"]:checked').value;
            
            // Check if registration is required
            if (whatsappVisibility === 'hidden' && !currentUser) {
                showToast('Please register to use the secure messaging system.', 'error');
                return;
            }
            
            try {
                // Generate verification code
                const verificationCode = generateVerificationCode();
                
                // For demo purposes, we'll simulate reporting an item
                const reportData = {
                    type: 'lost',
                    item: item,
                    location: location,
                    last_seen: lastSeen,
                    description: description,
                    contact_info: contact,
                    verification_code: verificationCode,
                    recovered: false,
                    user_id: currentUser ? currentUser.uid : null,
                    reporter: 'website',
                    whatsapp_visibility: whatsappVisibility,
                    timestamp: new Date().toISOString()
                };
                
                console.log('Lost item reported:', reportData);
                
                lostItemForm.reset();
                
                // Show toast with action button and verification code
                const message = `Your lost item has been reported successfully! Your verification code is "${verificationCode}". Please save it as you will need it later.`;
                showToast(message, 'success', {
                    text: 'View Details',
                    callback: () => {
                        showReportDetailsModal(reportData);
                    }
                });
                
                // Check for matching found items
                matchingFoundItems = await findMatchingItems(item, 'found');
                if (matchingFoundItems.length > 0) {
                    const matchMessage = `We found ${matchingFoundItems.length} matching item(s) that were reported found!`;
                    
                    // Show toast with action button
                    showToast(matchMessage, 'success', {
                        text: 'View Matching Items',
                        callback: () => {
                            showMatchingItemsModal(matchingFoundItems);
                        }
                    });
                }
            } catch (error) {
                console.error('Error reporting lost item:', error);
                showToast('Failed to report lost item. Please try again.', 'error');
            }
        });
        
        // Report Found Item
        foundItemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const item = document.getElementById('found-item').value;
            const location = document.getElementById('found-location').value;
            const contact = document.getElementById('found-contact').value;
            const whatsappVisibility = document.querySelector('input[name="found-whatsapp-visibility"]:checked').value;
            
            // Check if registration is required
            if (whatsappVisibility === 'hidden' && !currentUser) {
                showToast('Please register to use the secure messaging system.', 'error');
                return;
            }
            
            try {
                // Generate verification code
                const verificationCode = generateVerificationCode();
                
                // For demo purposes, we'll simulate reporting an item
                const reportData = {
                    type: 'found',
                    item: item,
                    location: location,
                    contact_phone: contact,
                    verification_code: verificationCode,
                    claimed: false,
                    user_id: currentUser ? currentUser.uid : null,
                    reporter: 'website',
                    whatsapp_visibility: whatsappVisibility,
                    timestamp: new Date().toISOString()
                };
                
                console.log('Found item reported:', reportData);
                
                foundItemForm.reset();
                
                // Show toast with action button and verification code
                const message = `Thanks for reporting an item, Please view your submission code "${verificationCode}" and save it as you will need it later.`;
                showToast(message, 'success', {
                    text: 'View Details',
                    callback: () => {
                        showReportDetailsModal(reportData);
                    }
                });
                
                // Show safety warning
                setTimeout(() => {
                    const safetyMessage = `IMPORTANT: When someone contacts you to claim this item, please ask for verification details (color, brand, unique features) to confirm ownership. Do not return the item without proper verification.`;
                    showToast(safetyMessage, 'success');
                }, 1000);
            } catch (error) {
                console.error('Error reporting found item:', error);
                showToast('Failed to report found item. Please try again.', 'error');
            }
        });
        
        // Search for Items
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
        
        async function performSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            const filter = filterType.value;
            
            if (!searchTerm) {
                showToast('Please enter a search term', 'error');
                return;
            }
            
            searchLoading.style.display = 'block';
            searchResults.innerHTML = '';
            
            try {
                // For demo purposes, we'll simulate searching items
                setTimeout(() => {
                    searchLoading.style.display = 'none';
                    
                    // Demo search results
                    const demoResults = [
                        {
                            id: 'demo-lost-id',
                            type: 'lost',
                            item: 'Water Bottle',
                            location: 'Library',
                            description: 'Blue water bottle with a sticker',
                            contact_info: '08012345678',
                            verification_code: 'ABC123',
                            recovered: false,
                            whatsapp_visibility: 'visible',
                            timestamp: new Date().toISOString()
                        },
                        {
                            id: 'demo-found-id',
                            type: 'found',
                            item: 'Wallet',
                            location: 'Cafeteria',
                            contact_phone: '08087654321',
                            verification_code: 'XYZ789',
                            claimed: false,
                            whatsapp_visibility: 'visible',
                            timestamp: new Date().toISOString()
                        }
                    ];
                    
                    if (demoResults.length === 0) {
                        searchResults.innerHTML = `<p class="text-center">No items found matching "${searchTerm}".</p>`;
                    } else {
                        let resultsHtml = `<h4 class="mb-3">Found ${demoResults.length} item(s) matching "${searchTerm}":</h4>`;
                        
                        demoResults.forEach(report => {
                            const date = new Date(report.timestamp).toLocaleString();
                            const isClaimed = report.claimed || false;
                            const isRecovered = report.recovered || false;
                            const cardClass = isClaimed || isRecovered ? 'result-item claimed' : 'result-item';
                            
                            if (report.type === 'found') {
                                const badgeClass = isClaimed ? 'badge-claimed' : 'badge-found';
                                const badgeText = isClaimed ? 'Claimed' : 'Found';
                                
                                // Check if WhatsApp number should be visible
                                const showWhatsApp = report.whatsapp_visibility === 'visible';
                                
                                resultsHtml += `
                                    <div class="${cardClass}">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <h5>${report.item}</h5>
                                                <div class="meta">
                                                    <i class="bi bi-geo-alt"></i> ${report.location}
                                                </div>
                                                <div class="meta">
                                                    <i class="bi bi-clock"></i> ${date}
                                                </div>
                                                ${report.description ? `<p class="mt-2">${report.description}</p>` : ''}
                                            </div>
                                            <span class="badge ${badgeClass}">${badgeText}</span>
                                        </div>
                                        ${showWhatsApp ? `
                                            <div class="mt-3">
                                                <i class="bi bi-whatsapp"></i> 
                                                <a href="https://wa.me/${report.contact_phone.replace(/^0/, '234')}" target="_blank" class="fw-bold">Contact via WhatsApp: ${report.contact_phone}</a>
                                            </div>
                                        ` : ''}
                                        ${!isClaimed ? `
                                            <div class="found-item-actions mt-3">
                                                <button class="btn btn-success btn-sm mark-claimed-btn" data-id="${report.id}" data-phone="${report.contact_phone}">
                                                    <i class="bi bi-check-circle"></i> Mark as Claimed
                                                </button>
                                                <button class="btn btn-primary btn-sm message-btn" data-id="${report.id}" data-type="found">
                                                    <i class="bi bi-chat-dots"></i> Send Message
                                                </button>
                                            </div>
                                        ` : `
                                            <div class="found-item-actions mt-3">
                                                <span class="claimed-status"><i class="bi bi-check-circle"></i> Successfully Claimed</span>
                                            </div>
                                        `}
                                    </div>
                                `;
                            } else {
                                const badgeClass = isRecovered ? 'badge-recovered' : 'badge-lost';
                                const badgeText = isRecovered ? 'Recovered' : 'Lost';
                                
                                // Check if WhatsApp number should be visible
                                const showWhatsApp = report.whatsapp_visibility === 'visible';
                                
                                resultsHtml += `
                                    <div class="${cardClass}">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <h5>${report.item}</h5>
                                                <div class="meta">
                                                    <i class="bi bi-geo-alt"></i> ${report.location}
                                                </div>
                                                ${report.last_seen ? `
                                                    <div class="meta">
                                                        <i class="bi bi-eye"></i> Last seen: ${report.last_seen}
                                                    </div>
                                                ` : ''}
                                                <div class="meta">
                                                    <i class="bi bi-clock"></i> ${date}
                                                </div>
                                                ${report.description ? `<p class="mt-2">${report.description}</p>` : ''}
                                            </div>
                                            <span class="badge ${badgeClass}">${badgeText}</span>
                                        </div>
                                        ${showWhatsApp && report.contact_info ? `
                                            <div class="mt-3">
                                                <i class="bi bi-whatsapp"></i> 
                                                <a href="https://wa.me/${report.contact_info.replace(/^0/, '234')}" target="_blank" class="fw-bold">Contact via WhatsApp: ${report.contact_info}</a>
                                            </div>
                                        ` : ''}
                                        ${!isRecovered ? `
                                            <div class="found-item-actions mt-3">
                                                <button class="btn btn-info btn-sm mark-recovered-btn" data-id="${report.id}" data-phone="${report.contact_info}">
                                                    <i class="bi bi-check-circle"></i> Mark as Recovered
                                                </button>
                                                <button class="btn btn-primary btn-sm message-btn" data-id="${report.id}" data-type="lost">
                                                    <i class="bi bi-chat-dots"></i> Send Message
                                                </button>
                                            </div>
                                        ` : `
                                            <div class="found-item-actions mt-3">
                                                <span class="claimed-status"><i class="bi bi-check-circle"></i> Successfully Recovered</span>
                                            </div>
                                        `}
                                    </div>
                                `;
                            }
                        });
                        
                        searchResults.innerHTML = resultsHtml;
                        
                        // Add event listeners to "Mark as Claimed" buttons
                        document.querySelectorAll('.mark-claimed-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const itemId = this.getAttribute('data-id');
                                const itemPhone = this.getAttribute('data-phone');
                                currentItemToClaim = { id: itemId, phone: itemPhone };
                                
                                // Clear the verification code input
                                verificationCodeInput.value = '';
                                
                                verificationModal.show();
                            });
                        });
                        
                        // Add event listeners to "Mark as Recovered" buttons
                        document.querySelectorAll('.mark-recovered-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const itemId = this.getAttribute('data-id');
                                const itemPhone = this.getAttribute('data-phone');
                                currentItemToRecover = { id: itemId, phone: itemPhone };
                                
                                // Clear the verification code input
                                lostVerificationCodeInput.value = '';
                                
                                lostVerificationModal.show();
                            });
                        });
                        
                        // Add event listeners to "Send Message" buttons
                        document.querySelectorAll('.message-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const itemId = this.getAttribute('data-id');
                                const itemType = this.getAttribute('data-type');
                                
                                // Start conversation
                                startConversation(itemId, 'demo-report-id');
                            });
                        });
                    }
                }, 1000);
            } catch (error) {
                console.error('Error searching items:', error);
                showToast('Failed to search items. Please try again.', 'error');
            }
        }
        
        // Find matching items (for lost item reporting)
        async function findMatchingItems(searchItem, type) {
            // For demo purposes, we'll return empty array
            return [];
        }
        
        // Handle "Confirm and Mark as Claimed" button
        confirmClaimBtn.addEventListener('click', async () => {
            if (!currentItemToClaim) return;
            
            const enteredCode = verificationCodeInput.value.trim().toUpperCase();
            
            if (!enteredCode) {
                showToast('Please enter your verification code', 'error');
                return;
            }
            
            try {
                // For demo purposes, we'll simulate verification
                console.log('Verification attempt:', enteredCode);
                
                verificationModal.hide();
                showToast('Item has been marked as claimed successfully!');
                
                currentItemToClaim = null;
            } catch (error) {
                console.error('Error marking item as claimed:', error);
                showToast('Failed to mark item as claimed. Please try again.', 'error');
            }
        });
        
        // Handle "Confirm and Mark as Recovered" button
        confirmRecoveredBtn.addEventListener('click', async () => {
            if (!currentItemToRecover) return;
            
            const enteredCode = lostVerificationCodeInput.value.trim().toUpperCase();
            
            if (!enteredCode) {
                showToast('Please enter your verification code', 'error');
                return;
            }
            
            try {
                // For demo purposes, we'll simulate verification
                console.log('Verification attempt:', enteredCode);
                
                lostVerificationModal.hide();
                showToast('Item has been marked as recovered successfully!');
                
                currentItemToRecover = null;
            } catch (error) {
                console.error('Error marking item as recovered:', error);
                showToast('Failed to mark item as recovered. Please try again.', 'error');
            }
        });
        
        // Messaging event listeners
        refreshConversationsBtn.addEventListener('click', loadConversations);
        
        sendMessageBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        shareContactBtn.addEventListener('click', shareContactInfo);
        
        reportConversationBtn.addEventListener('click', reportConversation);
        
        submitReportBtn.addEventListener('click', submitReport);
        
        // Image upload in message
        imageUpload.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            
            if (file && currentConversation && currentUser) {
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    const imageData = e.target.result;
                    
                    try {
                        // For demo purposes, we'll simulate sending an image
                        const messageData = {
                            sender_id: currentUser.uid,
                            text: imageData,
                            timestamp: new Date().toISOString(),
                            read: false,
                            type: 'image'
                        };
                        
                        // Add message to current messages array
                        currentMessages.push({
                            id: 'demo-message-id',
                            ...messageData
                        });
                        
                        // Clear input and refresh display
                        imageUpload.value = '';
                        imagePreview.src = '';
                        imagePreview.classList.remove('show');
                        displayMessages();
                        
                        showToast('Image sent successfully!', 'success');
                    } catch (error) {
                        console.error('Error sending image:', error);
                        showToast('Failed to send image. Please try again.', 'error');
                    }
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        // Initialize
        window.addEventListener('load', () => {
            createParticles();
        });
    </script>
</body>
</html>
