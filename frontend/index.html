<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KWASU Lost & Found Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #1a5276;
            --secondary-color: #2980b9;
            --accent-color: #f39c12;
            --light-bg: #ecf0f1;
            --supporter-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --message-sent: #dcf8c6;
            --message-received: #f1f0f0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: #333;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 4rem 0;
            text-align: center;
        }
        
        .hero-section h1 {
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .hero-section p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .section-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .section-card:hover {
            transform: translateY(-5px);
        }
        
        .section-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--accent-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .search-results {
            margin-top: 2rem;
        }
        
        .result-item {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid var(--accent-color);
        }
        
        .result-item h5 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .result-item .meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .result-item .meta i {
            margin-right: 5px;
        }
        
        .badge {
            font-size: 0.8rem;
            padding: 5px 10px;
        }
        
        .badge-lost {
            background-color: #e74c3c;
        }
        
        .badge-found {
            background-color: #2ecc71;
        }
        
        .badge-recovered {
            background-color: #17a2b8;
        }
        
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            margin-top: 4rem;
            text-align: center;
        }
        
        .footer a {
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .toast-success {
            border-left: 4px solid #2ecc71;
        }
        
        .toast-error {
            border-left: 4px solid #e74c3c;
        }
        
        .toast-body {
            position: relative;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .platform-icons {
            margin-top: 1rem;
        }
        
        .platform-icons a {
            color: white;
            font-size: 1.5rem;
            margin: 0 10px;
            transition: transform 0.3s ease;
        }
        
        .platform-icons a:hover {
            transform: scale(1.2);
        }
        
        .whatsapp-note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .safety-tips {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .safety-tips h5 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .safety-tips ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .safety-tips li {
            margin-bottom: 8px;
            color: #856404;
        }
        
        .safety-tips li:last-child {
            margin-bottom: 0;
        }
        
        .safety-tips i {
            color: #ffc107;
            margin-right: 8px;
        }
        
        /* Simple Section Break */
        .section-break {
            height: 2px;
            background: linear-gradient(to right, transparent, #ddd, transparent);
            margin: 3rem 0;
        }
        
        /* Enhanced Supporters Section */
        .supporters-section {
            background: var(--supporter-gradient);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 1rem;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .supporters-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(0.8); opacity: 0.5; }
        }
        
        .supporters-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .supporters-counter {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
            display: inline-block;
            min-width: 80px;
        }
        
        .supporters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .supporter-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .supporter-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .supporter-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 0.8rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .supporter-avatar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6ec7, #7873f5, #4bcffa, #f093fb);
            border-radius: 50%;
            z-index: -1;
            animation: rotate 3s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .supporter-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
        }
        
        .supporter-role {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 0.4rem;
        }
        
        .supporter-department {
            font-size: 0.8rem;
            opacity: 0.7;
            font-style: italic;
        }
        
        .toggle-supporters-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }
        
        .toggle-supporters-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .collapse {
            transition: max-height 0.5s ease;
        }
        
        .supporter-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--accent-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Floating particles animation */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: none;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Matching Items Modal */
        .matching-item-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-color);
        }
        
        .matching-item-card h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .matching-item-card .detail-row {
            display: flex;
            margin-bottom: 0.75rem;
        }
        
        .matching-item-card .detail-label {
            font-weight: 600;
            width: 120px;
            color: #555;
        }
        
        .matching-item-card .detail-value {
            flex: 1;
        }
        
        .matching-item-card .contact-btn {
            margin-top: 1rem;
            display: inline-block;
            background-color: #25D366;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .matching-item-card .contact-btn:hover {
            background-color: #128C7E;
            color: white;
        }
        
        /* Verification Modal */
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px 15px 0 0;
            border: none;
        }
        
        .modal-title {
            font-weight: 600;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        /* Founder Details Modal */
        .founder-details {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .founder-details h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .founder-details .detail-row {
            display: flex;
            margin-bottom: 0.75rem;
        }
        
        .founder-details .detail-label {
            font-weight: 600;
            width: 120px;
            color: #555;
        }
        
        .founder-details .detail-value {
            flex: 1;
        }
        
        .founder-details .contact-btn {
            margin-top: 1rem;
            display: inline-block;
            background-color: #25D366;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .founder-details .contact-btn:hover {
            background-color: #128C7E;
            color: white;
        }
        
        /* Found Item Actions */
        .found-item-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .claimed-status {
            background-color: #28a745;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* New styles for report details modal */
        .report-details-modal .modal-dialog {
            max-width: 600px;
        }
        
        .report-details-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .report-details-card h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .report-details-card .detail-row {
            display: flex;
            margin-bottom: 1rem;
        }
        
        .report-details-card .detail-label {
            font-weight: 600;
            width: 140px;
            color: #555;
        }
        
        .report-details-card .detail-value {
            flex: 1;
        }
        
        .verification-code-box {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            letter-spacing: 2px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .verification-code-box:hover {
            background-color: #dee2e6;
            transform: scale(1.02);
        }
        
        .copy-tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .copy-tooltip.show {
            opacity: 1;
        }
        
        .toast-action-btn {
            margin-top: 10px;
        }
        
        .safety-alert {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .safety-alert h6 {
            color: #721c24;
            margin-bottom: 10px;
        }
        
        .safety-alert p {
            color: #721c24;
            margin-bottom: 0;
        }
        
        .verification-input-group {
            margin: 1.5rem 0;
        }
        
        .verification-input {
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            letter-spacing: 3px;
        }
        
        .forgot-code-tip {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }
        
        .guide-section {
            background-color: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .guide-section h6 {
            color: #004c99;
            margin-bottom: 10px;
        }
        
        .guide-section ol {
            color: #004c99;
            padding-left: 20px;
        }
        
        .guide-section li {
            margin-bottom: 8px;
        }
        
        .guide-section li:last-child {
            margin-bottom: 0;
        }
        
        .importance-note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .importance-note h6 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .importance-note p {
            color: #856404;
            margin-bottom: 0;
        }
        
        .mark-as-recovered-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .mark-as-recovered-btn:hover {
            background-color: #138496;
            color: white;
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .verification-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-icon {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .lost-verification-modal .modal-body {
            text-align: center;
        }
        
        /* Messaging System Styles */
        .messaging-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .messaging-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .conversation-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
        }
        
        .conversation-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .conversation-item:hover {
            background-color: #f1f1f1;
        }
        
        .conversation-item.active {
            background-color: #e3f2fd;
            border-left: 4px solid var(--secondary-color);
        }
        
        .conversation-item:last-child {
            border-bottom: none;
        }
        
        .conversation-preview {
            display: flex;
            justify-content: space-between;
        }
        
        .conversation-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 4px;
        }
        
        .conversation-message {
            font-size: 0.9rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70%;
        }
        
        .conversation-time {
            font-size: 0.8rem;
            color: #999;
        }
        
        .conversation-unread {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .message-modal .modal-dialog {
            max-width: 800px;
            height: 600px;
        }
        
        .message-modal .modal-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .message-modal .modal-header {
            flex-shrink: 0;
        }
        
        .message-modal .modal-body {
            flex-grow: 1;
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .message-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #f5f5f5;
        }
        
        .message {
            max-width: 70%;
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }
        
        .message-sent {
            background-color: var(--message-sent);
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .message-received {
            background-color: var(--message-received);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: #999;
            text-align: right;
            margin-top: 5px;
        }
        
        .message-received .message-time {
            text-align: left;
        }
        
        .message-input-container {
            padding: 15px;
            border-top: 1px solid #ddd;
            background-color: white;
        }
        
        .message-input {
            border-radius: 20px;
            border: 1px solid #ddd;
            padding: 10px 20px;
            resize: none;
            height: auto;
            max-height: 120px;
        }
        
        .message-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .message-safety-tips {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .message-safety-tips i {
            color: #ffc107;
            margin-right: 5px;
        }
        
        .share-info-btn {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
            color: #495057;
        }
        
        .share-info-btn:hover {
            background-color: #e9ecef;
        }
        
        .report-conversation-btn {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
            color: #721c24;
        }
        
        .report-conversation-btn:hover {
            background-color: #f1b0b7;
        }
        
        .message-info-shared {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #155724;
        }
        
        .message-info-shared i {
            color: #28a745;
            margin-right: 5px;
        }
        
        .no-conversations {
            text-align: center;
            padding: 30px;
            color: #666;
        }
        
        .no-conversations i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .message-contact-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .message-contact-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .message-contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .message-contact-info {
            flex-grow: 1;
        }
        
        .message-contact-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .message-contact-item {
            font-size: 0.9rem;
            color: #666;
        }
        
        .message-contact-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-message {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .btn-message:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-message-outline {
            background-color: transparent;
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .btn-message-outline:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .message-status {
            font-size: 0.75rem;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }
        
        .message-verification-pending {
            color: var(--accent-color);
        }
        
        .message-verification-complete {
            color: #28a745;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <h1>KWASU Lost & Found Portal</h1>
            <p>Report lost items, found items, or search for your belongings across all platforms</p>
            <div class="platform-icons">
                <a href="https://t.me/KwasuLostFound_Bot" target="_blank" title="Telegram Bot"><i class="bi bi-telegram"></i></a>
                <a href="https://wa.link/9765zr" target="_blank" title="WhatsApp Bot"><i class="bi bi-whatsapp"></i></a>
            </div>
        </div>
    </section>

    <div class="container my-5">
        <div class="row">
            <!-- Report Lost Item Section -->
            <div class="col-lg-6 mb-4">
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="bi bi-search"></i> Report Lost Item
                    </h3>
                    <div class="whatsapp-note">
                        <i class="bi bi-whatsapp"></i> <strong>Important:</strong> Please provide your WhatsApp number for faster communication.
                    </div>
                    <form id="lost-item-form">
                        <div class="mb-3">
                            <label for="lost-item" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="lost-item" placeholder="e.g., Water Bottle, Wallet, Phone" required>
                        </div>
                        <div class="mb-3">
                            <label for="lost-location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="lost-location" placeholder="e.g., Library, Cafeteria, Lecture Hall" required>
                        </div>
                        <div class="mb-3">
                            <label for="lost-last-seen" class="form-label">Last Seen Location (if known)</label>
                            <input type="text" class="form-control" id="lost-last-seen" placeholder="e.g., Near the library entrance, Cafeteria table 5">
                        </div>
                        <div class="mb-3">
                            <label for="lost-description" class="form-label">Description</label>
                            <textarea class="form-control" id="lost-description" rows="3" placeholder="Provide details about your item (color, brand, unique features, etc.)" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="lost-contact" class="form-label">Your WhatsApp Number</label>
                            <input type="tel" class="form-control" id="lost-contact" placeholder="e.g., 08012345678" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Report Lost Item</button>
                    </form>
                </div>
            </div>

            <!-- Report Found Item Section -->
            <div class="col-lg-6 mb-4">
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="bi bi-gift"></i> Report Found Item
                    </h3>
                    <div class="whatsapp-note">
                        <i class="bi bi-whatsapp"></i> <strong>Important:</strong> Please provide your WhatsApp number for faster communication.
                    </div>
                    <form id="found-item-form">
                        <div class="mb-3">
                            <label for="found-item" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="found-item" placeholder="e.g., Keys, ID Card, Notebook" required>
                        </div>
                        <div class="mb-3">
                            <label for="found-location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="found-location" placeholder="e.g., Parking Lot, Classroom, Sports Complex" required>
                        </div>
                        <div class="mb-3">
                            <label for="found-contact" class="form-label">Your WhatsApp Number</label>
                            <input type="tel" class="form-control" id="found-contact" placeholder="e.g., 08012345678" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Report Found Item</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="bi bi-search"></i> Search for Items
            </h3>
            <div class="row">
                <div class="col-md-8">
                    <div class="input-group">
                        <input type="text" class="form-control" id="search-input" placeholder="Enter keywords (e.g., water, keys, bag)">
                        <button class="btn btn-primary" type="button" id="search-btn">Search</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="filter-type">
                        <option value="all">All Items</option>
                        <option value="lost">Lost Items Only</option>
                        <option value="found">Found Items Only</option>
                    </select>
                </div>
            </div>
            
            <div class="loading-spinner" id="search-loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Searching for items...</p>
            </div>
            
            <div class="search-results" id="search-results"></div>
        </div>

        <!-- Secure Direct Messaging Section -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="bi bi-chat-dots"></i> Secure Direct Messaging
            </h3>
            <p>Communicate securely with item owners or finders without immediately exposing personal contact information.</p>
            
            <div class="messaging-section">
                <div class="messaging-header">
                    <h5>Your Conversations</h5>
                    <button class="btn btn-sm btn-primary" id="refresh-conversations-btn">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
                
                <div class="conversation-list" id="conversation-list">
                    <div class="no-conversations">
                        <i class="bi bi-chat-square-text"></i>
                        <p>No conversations yet. Start a conversation from the search results.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Safety Tips Section -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="bi bi-shield-check"></i> Safety Tips
            </h3>
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle-fill"></i> <strong>Important:</strong> These safety guidelines are for school safety and to prevent scams. Please follow them carefully.
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="safety-tips">
                        <h5><i class="bi bi-person-x"></i> For Lost Item Reporters</h5>
                        <ul>
                            <li>When someone contacts you claiming to have found your item, ask for specific details to verify ownership</li>
                            <li>Never share personal information beyond what is necessary</li>
                            <li>Meet in a safe, public place on campus to retrieve your item</li>
                            <li>If you suspect a scam, report the person's number to KWASU Safety Unit or contact the developer</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="safety-tips">
                        <h5><i class="bi bi-person-check"></i> For Found Item Reporters</h5>
                        <ul>
                            <li>When someone claims an item, ask for evidence of ownership (specific details, photos, etc.)</li>
                            <li>Do not return the item until you are confident about the claimant's identity</li>
                            <li>If you notice a false claim, report the person's number to KWASU Safety Unit immediately</li>
                            <li>You can also contact the developer for assistance in reporting false claimants</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="mt-3 p-3 bg-light rounded">
                <h6 class="text-center"><i class="bi bi-info-circle"></i> How to Report Suspicious Activity</h6>
                <p class="mb-0 text-center">
                    <strong>KWASU Safety Unit:</strong> Contact campus security | 
                    <strong>Developer:</strong> <a href="tel:09038323588">Rugged</a>
                </p>
            </div>
        </div>

        <!-- Simple Section Break -->
        <div class="section-break"></div>

        <!-- Top Supporters Section -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="bi bi-people"></i> Top Supporters
            </h3>
            <p>We extend our heartfelt gratitude to the following individuals who supported this project:</p>
            
            <div class="supporters-section">
                <div class="particles" id="particles"></div>
                
                <div class="supporters-header">
                    <p>Meet our amazing supporters</p>
                    <div class="supporters-counter" id="supporters-counter">0</div>
                    <p>Incredible Contributors</p>
                    
                    <button class="btn toggle-supporters-btn" type="button" data-bs-toggle="collapse" data-bs-target="#supporters-list" aria-expanded="false" aria-controls="supporters-list">
                        <i class="bi bi-chevron-down"></i> <span id="toggle-text">View Supporters</span>
                    </button>
                </div>
                
                <div class="collapse mt-4" id="supporters-list">
                    <div class="supporters-grid">
                        <div class="supporter-card">
                            <div class="supporter-badge">1</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name One</div>
                            <div class="supporter-role">Project Mentor</div>
                            <div class="supporter-department">(Computer Science Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">2</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Two</div>
                            <div class="supporter-role">Technical Advisor</div>
                            <div class="supporter-department">(Mass Comm. Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">3</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Three</div>
                            <div class="supporter-role">Design Contributor</div>
                            <div class="supporter-department">(Fine Arts Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">4</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Four</div>
                            <div class="supporter-role">Content Creator</div>
                            <div class="supporter-department">(English Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">5</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Five</div>
                            <div class="supporter-role">Community Manager</div>
                            <div class="supporter-department">(Sociology Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">6</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Six</div>
                            <div class="supporter-role">Beta Tester</div>
                            <div class="supporter-department">(Mathematics Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">7</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Seven</div>
                            <div class="supporter-role">Marketing Support</div>
                            <div class="supporter-department">(Business Admin Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">8</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Eight</div>
                            <div class="supporter-role">Documentation</div>
                            <div class="supporter-department">(Library Science Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">9</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Nine</div>
                            <div class="supporter-role">Feedback Provider</div>
                            <div class="supporter-department">(Psychology Dpt.)</div>
                        </div>
                        
                        <div class="supporter-card">
                            <div class="supporter-badge">10</div>
                            <div class="supporter-avatar">FN</div>
                            <div class="supporter-name">Full Name Ten</div>
                            <div class="supporter-role">Evangelist</div>
                            <div class="supporter-department">(Political Science Dpt.)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 KWASU Lost & Found Portal. Designed & Developed by Rugged of ICT.</p>
            <p>For support: <a href="tel:09038323588">09038323588</a></p>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Report Details Modal -->
    <div class="modal fade report-details-modal" id="reportDetailsModal" tabindex="-1" aria-labelledby="reportDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportDetailsModalLabel">Report Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="reportDetailsContent">
                        <!-- Report details will be inserted here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Copy Tooltip -->
    <div class="copy-tooltip" id="copyTooltip">Copied to clipboard!</div>

    <!-- Matching Items Modal -->
    <div class="modal fade" id="matchingItemsModal" tabindex="-1" aria-labelledby="matchingItemsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="matchingItemsModalLabel">Matching Found Items</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="matchingItemsContent">
                        <!-- Matching items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal for Found Items -->
    <div class="modal fade" id="verificationModal" tabindex="-1" aria-labelledby="verificationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="verificationModalLabel">Verify Item Claim</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>To verify that you are the original reporter of this found item, please enter the verification code that was sent to your WhatsApp number when you first reported the item.</p>
                    
                    <div class="verification-input-group">
                        <label for="verification-code-input" class="form-label">Enter Verification Code:</label>
                        <input type="text" class="form-control verification-input" id="verification-code-input" placeholder="Enter your 6-character code" maxlength="6">
                    </div>
                    
                    <p class="forgot-code-tip">
                        <i class="bi bi-info-circle"></i> If you forgot your verification code, please contact the developer at <a href="tel:09038323588">09038323588</a>
                    </p>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="button" class="btn btn-primary" id="confirmClaimBtn">Confirm and Mark as Claimed</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal for Lost Items -->
    <div class="modal fade lost-verification-modal" id="lostVerificationModal" tabindex="-1" aria-labelledby="lostVerificationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="lostVerificationModalLabel">Verify Item Recovery</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body lost-verification-modal">
                    <div class="modal-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <p>To verify that you are the original reporter of this lost item, please enter the verification code that was generated when you first reported the item.</p>
                    
                    <div class="verification-input-group">
                        <label for="lost-verification-code-input" class="form-label">Enter Verification Code:</label>
                        <input type="text" class="form-control verification-input" id="lost-verification-code-input" placeholder="Enter your 6-character code" maxlength="6">
                    </div>
                    
                    <p class="forgot-code-tip">
                        <i class="bi bi-info-circle"></i> If you forgot your verification code, please contact the developer at <a href="tel:09038323588">09038323588</a>
                    </p>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="button" class="btn btn-primary" id="confirmRecoveredBtn">Confirm and Mark as Recovered</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Founder Details Modal -->
    <div class="modal fade" id="founderDetailsModal" tabindex="-1" aria-labelledby="founderDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="founderDetailsModalLabel">Founder Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="founderDetailsContent">
                        <!-- Founder details will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal fade message-modal" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageModalLabel">Conversation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="message-contact-card" id="message-contact-card">
                        <!-- Contact information will be inserted here -->
                    </div>
                    <div class="message-container" id="message-container">
                        <!-- Messages will be loaded here -->
                    </div>
                    <div class="message-input-container">
                        <textarea class="form-control message-input" id="message-input" placeholder="Type your message here..." rows="2"></textarea>
                        <div class="message-actions">
                            <div>
                                <button type="button" class="share-info-btn" id="share-contact-btn">
                                    <i class="bi bi-share"></i> Share Contact Info
                                </button>
                                <button type="button" class="report-conversation-btn" id="report-conversation-btn">
                                    <i class="bi bi-exclamation-triangle"></i> Report
                                </button>
                            </div>
                            <button type="button" class="btn btn-primary" id="send-message-btn">
                                <i class="bi bi-send"></i> Send
                            </button>
                        </div>
                        <div class="message-safety-tips" id="message-safety-tips">
                            <i class="bi bi-shield-exclamation"></i> <strong>Safety Tip:</strong> Do not share personal information until you have verified the other person's identity.
                        </div>
                        <div class="message-info-shared" id="message-info-shared" style="display: none;">
                            <i class="bi bi-check-circle"></i> You have shared your contact information with this user.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Conversation Modal -->
    <div class="modal fade" id="reportConversationModal" tabindex="-1" aria-labelledby="reportConversationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportConversationModalLabel">Report Conversation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Please provide details about why you are reporting this conversation:</p>
                    <div class="mb-3">
                        <label for="report-reason" class="form-label">Reason for Reporting</label>
                        <select class="form-select" id="report-reason">
                            <option value="">Select a reason</option>
                            <option value="spam">Spam or unwanted messages</option>
                            <option value="harassment">Harassment or abusive behavior</option>
                            <option value="scam">Suspected scam or fraud</option>
                            <option value="inappropriate">Inappropriate content</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="report-details" class="form-label">Additional Details</label>
                        <textarea class="form-control" id="report-details" rows="3" placeholder="Please provide more details about the issue..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="submit-report-btn">Submit Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            databaseURL: "https://kwasu-lost-and-found-default-rtdb.firebaseio.com/"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // DOM Elements
        const lostItemForm = document.getElementById('lost-item-form');
        const foundItemForm = document.getElementById('found-item-form');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const filterType = document.getElementById('filter-type');
        const searchResults = document.getElementById('search-results');
        const searchLoading = document.getElementById('search-loading');
        const toastContainer = document.querySelector('.toast-container');
        const toggleText = document.getElementById('toggle-text');
        const supportersList = document.getElementById('supporters-list');
        const supportersCounter = document.getElementById('supporters-counter');
        const particles = document.getElementById('particles');
        const matchingItemsModal = new bootstrap.Modal(document.getElementById('matchingItemsModal'));
        const matchingItemsContent = document.getElementById('matchingItemsContent');
        const verificationModal = new bootstrap.Modal(document.getElementById('verificationModal'));
        const verificationCodeInput = document.getElementById('verification-code-input');
        const confirmClaimBtn = document.getElementById('confirmClaimBtn');
        const lostVerificationModal = new bootstrap.Modal(document.getElementById('lostVerificationModal'));
        const lostVerificationCodeInput = document.getElementById('lost-verification-code-input');
        const confirmRecoveredBtn = document.getElementById('confirmRecoveredBtn');
        const founderDetailsModal = new bootstrap.Modal(document.getElementById('founderDetailsModal'));
        const founderDetailsContent = document.getElementById('founderDetailsContent');
        const reportDetailsModal = new bootstrap.Modal(document.getElementById('reportDetailsModal'));
        const reportDetailsContent = document.getElementById('reportDetailsContent');
        const copyTooltip = document.getElementById('copyTooltip');
        
        // Messaging System Elements
        const conversationList = document.getElementById('conversation-list');
        const refreshConversationsBtn = document.getElementById('refresh-conversations-btn');
        const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));
        const messageModalLabel = document.getElementById('messageModalLabel');
        const messageContactCard = document.getElementById('message-contact-card');
        const messageContainer = document.getElementById('message-container');
        const messageInput = document.getElementById('message-input');
        const sendMessageBtn = document.getElementById('send-message-btn');
        const shareContactBtn = document.getElementById('share-contact-btn');
        const reportConversationBtn = document.getElementById('report-conversation-btn');
        const messageSafetyTips = document.getElementById('message-safety-tips');
        const messageInfoShared = document.getElementById('message-info-shared');
        const reportConversationModal = new bootstrap.Modal(document.getElementById('reportConversationModal'));
        const reportReason = document.getElementById('report-reason');
        const reportDetails = document.getElementById('report-details');
        const submitReportBtn = document.getElementById('submit-report-btn');
        
        // Global variables
        let currentItemToClaim = null;
        let currentItemToRecover = null;
        let matchingFoundItems = [];
        let lastReportData = null;
        let currentConversation = null;
        let currentMessages = [];
        let contactInfoShared = {};
        
        // Create floating particles
        function createParticles() {
            const particleCount = 20;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 5 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animation = 'float linear infinite';
                
                particles.appendChild(particle);
            }
        }
        
        // Generate random verification code
        function generateVerificationCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        // Generate conversation ID
        function generateConversationId(reportId1, reportId2) {
            // Sort the IDs to ensure consistent conversation ID regardless of who initiates
            const sortedIds = [reportId1, reportId2].sort();
            return sortedIds.join('_');
        }
        
        // Animate counter
        function animateCounter(target, duration = 2000) {
            let start = 0;
            const increment = target / (duration / 16);
            
            const timer = setInterval(() => {
                start += increment;
                if (start >= target) {
                    supportersCounter.textContent = target;
                    clearInterval(timer);
                } else {
                    supportersCounter.textContent = Math.floor(start);
                }
            }, 16);
        }
        
        // Toggle Supporters List
        supportersList.addEventListener('show.bs.collapse', function () {
            toggleText.textContent = 'Hide Supporters';
            animateCounter(10);
        });
        
        supportersList.addEventListener('hide.bs.collapse', function () {
            toggleText.textContent = 'View Supporters';
            supportersCounter.textContent = '0';
        });
        
        // Show toast notification with action button
        function showToast(message, type = 'success', actionButton = null) {
            const toastId = 'toast-' + Date.now();
            const toastHtml = `
                <div id="${toastId}" class="toast toast-${type}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <i class="bi bi-${type === 'success' ? 'check-circle-fill text-success' : 'exclamation-triangle-fill text-danger'} me-2"></i>
                        <strong class="me-auto">KWASU Lost & Found</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                        ${actionButton ? `<button type="button" class="btn btn-sm btn-primary mt-2 toast-action-btn">${actionButton.text}</button>` : ''}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { autohide: false }); // Disable auto-hide
            toast.show();
            
            // Add click event if action button is provided
            if (actionButton) {
                const actionBtn = toastElement.querySelector('.toast-action-btn');
                actionBtn.addEventListener('click', () => {
                    actionButton.callback();
                    toast.hide();
                });
            }
            
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }
        
        // Show report details modal
        function showReportDetailsModal(reportData) {
            let html = '';
            
            if (reportData.type === 'lost') {
                html = `
                    <div class="report-details-card">
                        <h5><i class="bi bi-search"></i> Lost Item Details</h5>
                        <div class="detail-row">
                            <div class="detail-label">Item Name:</div>
                            <div class="detail-value">${reportData.item}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Location:</div>
                            <div class="detail-value">${reportData.location}</div>
                        </div>
                        ${reportData.last_seen ? `
                        <div class="detail-row">
                            <div class="detail-label">Last Seen:</div>
                            <div class="detail-value">${reportData.last_seen}</div>
                        </div>
                        ` : ''}
                        <div class="detail-row">
                            <div class="detail-label">Description:</div>
                            <div class="detail-value">${reportData.description}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact:</div>
                            <div class="detail-value">${reportData.contact_info}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Verification Code:</div>
                            <div class="detail-value">
                                <div class="verification-code-box" id="lostReportVerificationCode">
                                    ${reportData.verification_code}
                                </div>
                                <small class="text-muted">Click to copy</small>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported On:</div>
                            <div class="detail-value">${new Date(reportData.timestamp).toLocaleString()}</div>
                        </div>
                        
                        <div class="importance-note">
                            <h6><i class="bi bi-exclamation-triangle-fill"></i> Why You Need to Save This Code</h6>
                            <p>This verification code is your proof that you reported this lost item. You will need it to:</p>
                            <ul>
                                <li>Verify your identity when marking the item as recovered</li>
                                <li>Prevent unauthorized users from marking your item as recovered</li>
                                <li>Ensure the security and integrity of your report</li>
                            </ul>
                            <p class="mb-0"><strong>Please save this code by taking a screenshot or writing it down!</strong></p>
                        </div>
                        
                        <div class="guide-section">
                            <h6><i class="bi bi-list-ol"></i> How to Mark Your Item as Recovered</h6>
                            <p>After you've recovered your lost item, please follow these steps to mark it as recovered:</p>
                            <ol>
                                <li>Return to this website (KWASU Lost & Found Portal)</li>
                                <li>Scroll down to the search section</li>
                                <li>Search for the item you reported using keywords</li>
                                <li>Find your reported item in the search results</li>
                                <li>Click the "Mark as Recovered" button</li>
                                <li>Enter your verification code when prompted</li>
                                <li>Confirm to mark the item as recovered</li>
                            </ol>
                            
                            <h6 class="mt-3"><i class="bi bi-heart-fill text-danger"></i> Why This Is Important</h6>
                            <p>Marking items as recovered helps keep our database clean and prevents confusion for other users. It also helps us track the success of this portal in reuniting lost items with their owners.</p>
                        </div>
                        
                        <div class="safety-alert">
                            <h6><i class="bi bi-shield-exclamation"></i> Safety Tips for Lost Item Reporters</h6>
                            <p>When someone contacts you claiming to have found your item:</p>
                            <ul>
                                <li>Ask for specific details about the item to verify ownership</li>
                                <li>Never share personal information beyond what is necessary</li>
                                <li>Meet in a safe, public place on campus to retrieve your item</li>
                                <li>If you suspect a scam, report the person's number to KWASU Safety Unit or contact the developer at 09038323588</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else if (reportData.type === 'found') {
                html = `
                    <div class="report-details-card">
                        <h5><i class="bi bi-gift"></i> Found Item Details</h5>
                        <div class="detail-row">
                            <div class="detail-label">Item Name:</div>
                            <div class="detail-value">${reportData.item}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Location:</div>
                            <div class="detail-value">${reportData.location}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact:</div>
                            <div class="detail-value">${reportData.contact_phone}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Verification Code:</div>
                            <div class="detail-value">
                                <div class="verification-code-box" id="foundReportVerificationCode">
                                    ${reportData.verification_code}
                                </div>
                                <small class="text-muted">Click to copy</small>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported On:</div>
                            <div class="detail-value">${new Date(reportData.timestamp).toLocaleString()}</div>
                        </div>
                        
                        <div class="importance-note">
                            <h6><i class="bi bi-exclamation-triangle-fill"></i> Why You Need to Save This Code</h6>
                            <p>This verification code is your proof that you reported this item. You will need it to:</p>
                            <ul>
                                <li>Verify your identity when someone claims this item</li>
                                <li>Mark the item as claimed after returning it to the owner</li>
                                <li>Prevent false claims and scams</li>
                            </ul>
                            <p class="mb-0"><strong>Please save this code by taking a screenshot or writing it down!</strong></p>
                        </div>
                        
                        <div class="guide-section">
                            <h6><i class="bi bi-list-ol"></i> How to Mark Item as Claimed After Returning to Owner</h6>
                            <p>After you've returned the item to its rightful owner, please follow these steps to mark it as claimed:</p>
                            <ol>
                                <li>Return to this website (KWASU Lost & Found Portal)</li>
                                <li>Scroll down to the search section</li>
                                <li>Search for the item you reported using keywords</li>
                                <li>Find your reported item in the search results</li>
                                <li>Click the "Mark as Claimed" button</li>
                                <li>Enter your verification code when prompted</li>
                                <li>Confirm to mark the item as claimed</li>
                            </ol>
                            
                            <h6 class="mt-3"><i class="bi bi-heart-fill text-danger"></i> Why This Is Important</h6>
                            <p>Marking items as claimed helps keep our database clean and prevents confusion for other users. It also helps us track the success of this portal in reuniting lost items with their owners.</p>
                        </div>
                        
                        <div class="safety-alert">
                            <h6><i class="bi bi-shield-exclamation"></i> Important Safety Information</h6>
                            <p>When someone claims this item:</p>
                            <ul>
                                <li>Ask for specific details about the item to verify ownership</li>
                                <li>Do not return the item until you are confident about the claimant's identity</li>
                                <li>If you notice a false claim, report the person's number to KWASU Safety Unit immediately</li>
                                <li>You can also contact the developer for assistance in reporting false claimants</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            reportDetailsContent.innerHTML = html;
            reportDetailsModal.show();
            
            // Add click event to verification code to copy to clipboard
            const codeElementId = reportData.type === 'lost' ? 'lostReportVerificationCode' : 'foundReportVerificationCode';
            const codeElement = document.getElementById(codeElementId);
            if (codeElement) {
                codeElement.addEventListener('click', (e) => {
                    const code = reportData.verification_code;
                    navigator.clipboard.writeText(code).then(() => {
                        // Show tooltip
                        copyTooltip.style.left = e.pageX + 'px';
                        copyTooltip.style.top = (e.pageY - 30) + 'px';
                        copyTooltip.classList.add('show');
                        
                        setTimeout(() => {
                            copyTooltip.classList.remove('show');
                        }, 2000);
                    }).catch(err => {
                        console.error('Could not copy text: ', err);
                        showToast('Failed to copy verification code.', 'error');
                    });
                });
            }
        }
        
        // Show matching items modal
        function showMatchingItemsModal(matchingItems) {
            let html = '';
            
            matchingItems.forEach((item, index) => {
                const date = new Date(item.timestamp).toLocaleString();
                html += `
                    <div class="matching-item-card">
                        <h5>Matching Item #${index + 1}</h5>
                        <div class="detail-row">
                            <div class="detail-label">Item Name:</div>
                            <div class="detail-value">${item.item}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Found At:</div>
                            <div class="detail-value">${item.location}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported On:</div>
                            <div class="detail-value">${date}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact:</div>
                            <div class="detail-value">
                                <a href="https://wa.me/${item.contact_phone.replace(/^0/, '234')}" target="_blank" class="contact-btn">
                                    <i class="bi bi-whatsapp"></i> WhatsApp: ${item.contact_phone}
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            matchingItemsContent.innerHTML = html;
            matchingItemsModal.show();
        }
        
        // Load conversations
        async function loadConversations() {
            try {
                const snapshot = await database.ref('conversations').once('value');
                const conversations = snapshot.val();
                
                if (!conversations) {
                    conversationList.innerHTML = `
                        <div class="no-conversations">
                            <i class="bi bi-chat-square-text"></i>
                            <p>No conversations yet. Start a conversation from the search results.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                let hasConversations = false;
                
                // Get the current user's reports to identify their conversations
                const reportsSnapshot = await database.ref('reports').once('value');
                const reports = reportsSnapshot.val();
                const userReportIds = [];
                
                if (reports) {
                    Object.entries(reports).forEach(([key, report]) => {
                        if ((report.type === 'lost' && report.contact_info) || 
                            (report.type === 'found' && report.contact_phone)) {
                            userReportIds.push(key);
                        }
                    });
                }
                
                // Find conversations involving the user's reports
                Object.entries(conversations).forEach(([conversationId, conversation]) => {
                    const participants = conversationId.split('_');
                    
                    if (participants.some(id => userReportIds.includes(id))) {
                        hasConversations = true;
                        
                        // Get the other participant (not the current user)
                        const otherParticipantId = participants.find(id => !userReportIds.includes(id));
                        
                        // Get the other participant's report details
                        let otherReport = null;
                        if (reports && reports[otherParticipantId]) {
                            otherReport = reports[otherParticipantId];
                        }
                        
                        // Get the last message
                        const messages = conversation.messages || {};
                        let lastMessage = null;
                        let lastMessageTime = 0;
                        
                        Object.entries(messages).forEach(([messageId, message]) => {
                            if (message.timestamp > lastMessageTime) {
                                lastMessageTime = message.timestamp;
                                lastMessage = message;
                            }
                        });
                        
                        if (lastMessage) {
                            const date = new Date(lastMessage.timestamp);
                            const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                            
                            // Check if there are unread messages
                            const unreadCount = Object.values(messages).filter(msg => 
                                !msg.read && msg.sender_id !== userReportIds[0]
                            ).length;
                            
                            html += `
                                <div class="conversation-item" data-conversation-id="${conversationId}">
                                    <div class="conversation-preview">
                                        <div>
                                            <div class="conversation-title">
                                                ${otherReport ? otherReport.item : 'Unknown Item'}
                                                ${unreadCount > 0 ? `<span class="conversation-unread">${unreadCount}</span>` : ''}
                                            </div>
                                            <div class="conversation-message">${lastMessage.text}</div>
                                        </div>
                                        <div class="conversation-time">${formattedTime}</div>
                                    </div>
                                </div>
                            `;
                        }
                    }
                });
                
                if (!hasConversations) {
                    html = `
                        <div class="no-conversations">
                            <i class="bi bi-chat-square-text"></i>
                            <p>No conversations yet. Start a conversation from the search results.</p>
                        </div>
                    `;
                }
                
                conversationList.innerHTML = html;
                
                // Add click event to conversation items
                document.querySelectorAll('.conversation-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const conversationId = this.getAttribute('data-conversation-id');
                        openConversation(conversationId);
                    });
                });
            } catch (error) {
                console.error('Error loading conversations:', error);
                showToast('Failed to load conversations. Please try again.', 'error');
            }
        }
        
        // Open conversation
        async function openConversation(conversationId) {
            try {
                currentConversation = conversationId;
                
                // Get conversation data
                const conversationSnapshot = await database.ref(`conversations/${conversationId}`).once('value');
                const conversation = conversationSnapshot.val();
                
                if (!conversation) {
                    showToast('Conversation not found.', 'error');
                    return;
                }
                
                // Get participant IDs
                const participants = conversationId.split('_');
                
                // Get reports for both participants
                const reportsSnapshot = await database.ref('reports').once('value');
                const reports = reportsSnapshot.val();
                
                const report1 = reports[participants[0]];
                const report2 = reports[participants[1]];
                
                if (!report1 || !report2) {
                    showToast('Could not load conversation details.', 'error');
                    return;
                }
                
                // Determine which report belongs to the current user
                const userReportId = localStorage.getItem('lastReportId');
                const userReport = userReportId === participants[0] ? report1 : report2;
                const otherReport = userReportId === participants[0] ? report2 : report1;
                
                // Set modal title
                messageModalLabel.textContent = `Conversation about ${otherReport.item}`;
                
                // Set contact card
                const contactInitials = (otherReport.item || 'U').substring(0, 2).toUpperCase();
                const contactType = otherReport.type === 'lost' ? 'Lost Item Reporter' : 'Found Item Reporter';
                
                messageContactCard.innerHTML = `
                    <div class="message-contact-header">
                        <div class="message-contact-avatar">${contactInitials}</div>
                        <div class="message-contact-info">
                            <div class="message-contact-name">${otherReport.item}</div>
                            <div class="message-contact-item">${contactType}</div>
                            <div class="message-contact-item">Location: ${otherReport.location}</div>
                            <div class="message-status ${contactInfoShared[conversationId] ? 'message-verification-complete' : 'message-verification-pending'}">
                                ${contactInfoShared[conversationId] ? 
                                    '<i class="bi bi-check-circle-fill"></i> Contact information shared' : 
                                    '<i class="bi bi-shield-exclamation"></i> Anonymous - No contact information shared yet'}
                            </div>
                        </div>
                    </div>
                `;
                
                // Load messages
                currentMessages = [];
                const messages = conversation.messages || {};
                
                Object.entries(messages).forEach(([messageId, message]) => {
                    currentMessages.push({
                        id: messageId,
                        ...message
                    });
                });
                
                // Sort messages by timestamp
                currentMessages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                // Display messages
                displayMessages();
                
                // Mark messages as read
                if (userReportId) {
                    Object.entries(messages).forEach(([messageId, message]) => {
                        if (message.sender_id !== userReportId && !message.read) {
                            database.ref(`conversations/${conversationId}/messages/${messageId}/read`).set(true);
                        }
                    });
                }
                
                // Show modal
                messageModal.show();
                
                // Focus on message input
                setTimeout(() => {
                    messageInput.focus();
                }, 500);
                
                // Update contact info shared status
                if (contactInfoShared[conversationId]) {
                    messageSafetyTips.style.display = 'none';
                    messageInfoShared.style.display = 'block';
                } else {
                    messageSafetyTips.style.display = 'block';
                    messageInfoShared.style.display = 'none';
                }
            } catch (error) {
                console.error('Error opening conversation:', error);
                showToast('Failed to open conversation. Please try again.', 'error');
            }
        }
        
        // Display messages in the conversation
        function displayMessages() {
            let html = '';
            
            if (currentMessages.length === 0) {
                html = `
                    <div class="no-conversations">
                        <i class="bi bi-chat-dots"></i>
                        <p>No messages yet. Start the conversation!</p>
                    </div>
                `;
            } else {
                const userReportId = localStorage.getItem('lastReportId');
                
                currentMessages.forEach(message => {
                    const isSent = message.sender_id === userReportId;
                    const date = new Date(message.timestamp);
                    const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    
                    html += `
                        <div class="message ${isSent ? 'message-sent' : 'message-received'}">
                            <div>${message.text}</div>
                            <div class="message-time">${formattedTime}</div>
                        </div>
                    `;
                });
            }
            
            messageContainer.innerHTML = html;
            
            // Scroll to bottom
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }
        
        // Send message
        async function sendMessage() {
            const text = messageInput.value.trim();
            
            if (!text || !currentConversation) {
                return;
            }
            
            try {
                const userReportId = localStorage.getItem('lastReportId');
                
                if (!userReportId) {
                    showToast('Could not identify your report. Please try again.', 'error');
                    return;
                }
                
                const newMessageRef = database.ref(`conversations/${currentConversation}/messages`).push();
                const messageData = {
                    sender_id: userReportId,
                    text: text,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                await newMessageRef.set(messageData);
                
                // Add message to current messages array
                currentMessages.push({
                    id: newMessageRef.key,
                    ...messageData
                });
                
                // Clear input and refresh display
                messageInput.value = '';
                displayMessages();
                
                // Update conversation list
                loadConversations();
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Failed to send message. Please try again.', 'error');
            }
        }
        
        // Share contact information
        async function shareContactInfo() {
            if (!currentConversation) {
                return;
            }
            
            try {
                const userReportId = localStorage.getItem('lastReportId');
                
                if (!userReportId) {
                    showToast('Could not identify your report. Please try again.', 'error');
                    return;
                }
                
                // Get user's report
                const reportSnapshot = await database.ref(`reports/${userReportId}`).once('value');
                const report = reportSnapshot.val();
                
                if (!report) {
                    showToast('Could not find your report. Please try again.', 'error');
                    return;
                }
                
                // Get contact info based on report type
                const contactInfo = report.type === 'lost' ? report.contact_info : report.contact_phone;
                
                if (!contactInfo) {
                    showToast('No contact information available for your report.', 'error');
                    return;
                }
                
                // Send contact info as a message
                const newMessageRef = database.ref(`conversations/${currentConversation}/messages`).push();
                const messageData = {
                    sender_id: userReportId,
                    text: `I've shared my contact information: ${contactInfo}`,
                    timestamp: new Date().toISOString(),
                    read: false,
                    is_contact_info: true
                };
                
                await newMessageRef.set(messageData);
                
                // Mark contact info as shared
                contactInfoShared[currentConversation] = true;
                
                // Add message to current messages array
                currentMessages.push({
                    id: newMessageRef.key,
                    ...messageData
                });
                
                // Update UI
                messageSafetyTips.style.display = 'none';
                messageInfoShared.style.display = 'block';
                
                // Update contact status
                const statusElement = messageContactCard.querySelector('.message-status');
                if (statusElement) {
                    statusElement.className = 'message-status message-verification-complete';
                    statusElement.innerHTML = '<i class="bi bi-check-circle-fill"></i> Contact information shared';
                }
                
                // Refresh display
                displayMessages();
                
                // Show confirmation
                showToast('Your contact information has been shared securely.', 'success');
                
                // Update conversation list
                loadConversations();
            } catch (error) {
                console.error('Error sharing contact info:', error);
                showToast('Failed to share contact information. Please try again.', 'error');
            }
        }
        
        // Report conversation
        function reportConversation() {
            reportReason.value = '';
            reportDetails.value = '';
            reportConversationModal.show();
        }
        
        // Submit report
        async function submitReport() {
            const reason = reportReason.value;
            const details = reportDetails.value.trim();
            
            if (!reason) {
                showToast('Please select a reason for reporting.', 'error');
                return;
            }
            
            try {
                const reportRef = database.ref('conversation_reports').push();
                const reportData = {
                    conversation_id: currentConversation,
                    reason: reason,
                    details: details,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                await reportRef.set(reportData);
                
                reportConversationModal.hide();
                messageModal.hide();
                
                showToast('Your report has been submitted. Thank you for helping keep our community safe.', 'success');
            } catch (error) {
                console.error('Error submitting report:', error);
                showToast('Failed to submit report. Please try again.', 'error');
            }
        }
        
        // Start a new conversation
        async function startConversation(reportId1, reportId2) {
            try {
                // Generate conversation ID
                const conversationId = generateConversationId(reportId1, reportId2);
                
                // Check if conversation already exists
                const conversationSnapshot = await database.ref(`conversations/${conversationId}`).once('value');
                const conversation = conversationSnapshot.val();
                
                if (!conversation) {
                    // Create new conversation
                    await database.ref(`conversations/${conversationId}`).set({
                        created_at: new Date().toISOString(),
                        participants: [reportId1, reportId2]
                    });
                }
                
                // Store the last report ID for identifying the user
                localStorage.setItem('lastReportId', reportId1);
                
                // Open conversation
                openConversation(conversationId);
                
                // Refresh conversation list
                loadConversations();
            } catch (error) {
                console.error('Error starting conversation:', error);
                showToast('Failed to start conversation. Please try again.', 'error');
            }
        }
        
        // Report Lost Item
        lostItemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const item = document.getElementById('lost-item').value;
            const location = document.getElementById('lost-location').value;
            const lastSeen = document.getElementById('lost-last-seen').value;
            const description = document.getElementById('lost-description').value;
            const contact = document.getElementById('lost-contact').value;
            
            try {
                // Generate verification code
                const verificationCode = generateVerificationCode();
                
                const newReportRef = database.ref('reports').push();
                const reportData = {
                    type: 'lost',
                    item: item, // Keep original formatting
                    location: location, // Keep original formatting
                    last_seen: lastSeen, // Keep original formatting
                    description: description, // Keep original formatting
                    contact_info: contact,
                    verification_code: verificationCode,
                    recovered: false,
                    reporter: 'website',
                    timestamp: new Date().toISOString()
                };
                
                await newReportRef.set(reportData);
                
                // Store the report ID for future use
                localStorage.setItem('lastReportId', newReportRef.key);
                
                lostItemForm.reset();
                
                // Show toast with action button and verification code
                const message = `Your lost item has been reported successfully! Your verification code is "${verificationCode}". Please save it as you will need it later.`;
                showToast(message, 'success', {
                    text: 'View Details',
                    callback: () => {
                        showReportDetailsModal(reportData);
                    }
                });
                
                // Check for matching found items
                matchingFoundItems = await findMatchingItems(item, 'found');
                if (matchingFoundItems.length > 0) {
                    const matchMessage = `We found ${matchingFoundItems.length} matching item(s) that were reported found!`;
                    
                    // Show toast with action button
                    showToast(matchMessage, 'success', {
                        text: 'View Matching Items',
                        callback: () => {
                            showMatchingItemsModal(matchingFoundItems);
                        }
                    });
                }
            } catch (error) {
                console.error('Error reporting lost item:', error);
                showToast('Failed to report lost item. Please try again.', 'error');
            }
        });
        
        // Report Found Item
        foundItemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const item = document.getElementById('found-item').value;
            const location = document.getElementById('found-location').value;
            const contact = document.getElementById('found-contact').value;
            
            try {
                // Generate verification code
                const verificationCode = generateVerificationCode();
                
                const newReportRef = database.ref('reports').push();
                const reportData = {
                    type: 'found',
                    item: item, // Keep original formatting
                    location: location, // Keep original formatting
                    contact_phone: contact,
                    verification_code: verificationCode,
                    claimed: false,
                    reporter: 'website',
                    timestamp: new Date().toISOString()
                };
                
                await newReportRef.set(reportData);
                
                // Store the report ID for future use
                localStorage.setItem('lastReportId', newReportRef.key);
                
                foundItemForm.reset();
                
                // Show toast with action button and verification code
                const message = `Thanks for reporting an item, Please view your submission code "${verificationCode}" and save it as you will need it later🙏.`;
                showToast(message, 'success', {
                    text: 'View Details',
                    callback: () => {
                        showReportDetailsModal(reportData);
                    }
                });
                
                // Show safety warning
                setTimeout(() => {
                    const safetyMessage = `IMPORTANT: When someone contacts you to claim this item, please ask for verification details (color, brand, unique features) to confirm ownership. Do not return the item without proper verification.`;
                    showToast(safetyMessage, 'success');
                }, 1000);
            } catch (error) {
                console.error('Error reporting found item:', error);
                showToast('Failed to report found item. Please try again.', 'error');
            }
        });
        
        // Search for Items
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
        
        async function performSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            const filter = filterType.value;
            
            if (!searchTerm) {
                showToast('Please enter a search term', 'error');
                return;
            }
            
            searchLoading.style.display = 'block';
            searchResults.innerHTML = '';
            
            try {
                const snapshot = await database.ref('reports').once('value');
                const reports = snapshot.val();
                
                if (!reports) {
                    searchResults.innerHTML = '<p class="text-center">No items found in the database.</p>';
                    searchLoading.style.display = 'none';
                    return;
                }
                
                const results = [];
                const twoDaysAgo = new Date();
                twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
                
                Object.entries(reports).forEach(([key, report]) => {
                    // Filter out items that were claimed/recovered more than 2 days ago
                    if ((report.claimed && report.claimed_at && new Date(report.claimed_at) < twoDaysAgo) ||
                        (report.recovered && report.recovered_at && new Date(report.recovered_at) < twoDaysAgo)) {
                        return;
                    }
                    
                    if (filter !== 'all' && report.type !== filter) return;
                    
                    const searchText = `${report.item} ${report.location} ${report.description || ''}`.toLowerCase();
                    if (searchText.includes(searchTerm)) {
                        results.push({ ...report, id: key });
                    }
                });
                
                // Sort results by timestamp (most recent first)
                results.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                if (results.length === 0) {
                    searchResults.innerHTML = `<p class="text-center">No items found matching "${searchTerm}".</p>`;
                } else {
                    let resultsHtml = `<h4 class="mb-3">Found ${results.length} item(s) matching "${searchTerm}":</h4>`;
                    
                    results.forEach(report => {
                        const date = new Date(report.timestamp).toLocaleString();
                        const isClaimed = report.claimed || false;
                        const isRecovered = report.recovered || false;
                        const cardClass = isClaimed || isRecovered ? 'result-item claimed' : 'result-item';
                        
                        if (report.type === 'found') {
                            const badgeClass = isClaimed ? 'badge-claimed' : 'badge-found';
                            const badgeText = isClaimed ? 'Claimed' : 'Found';
                            
                            resultsHtml += `
                                <div class="${cardClass}">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h5>${report.item}</h5>
                                            <div class="meta">
                                                <i class="bi bi-geo-alt"></i> ${report.location}
                                            </div>
                                            <div class="meta">
                                                <i class="bi bi-clock"></i> ${date}
                                            </div>
                                            ${report.description ? `<p class="mt-2">${report.description}</p>` : ''}
                                        </div>
                                        <span class="badge ${badgeClass}">${badgeText}</span>
                                    </div>
                                    <div class="mt-3">
                                        <i class="bi bi-whatsapp"></i> 
                                        <a href="https://wa.me/${report.contact_phone.replace(/^0/, '234')}" target="_blank" class="fw-bold">Contact via WhatsApp: ${report.contact_phone}</a>
                                    </div>
                                    ${!isClaimed ? `
                                        <div class="found-item-actions mt-3">
                                            <button class="btn btn-success btn-sm mark-claimed-btn" data-id="${report.id}" data-phone="${report.contact_phone}">
                                                <i class="bi bi-check-circle"></i> Mark as Claimed
                                            </button>
                                            <button class="btn btn-primary btn-sm message-btn" data-id="${report.id}" data-type="found">
                                                <i class="bi bi-chat-dots"></i> Send Message
                                            </button>
                                        </div>
                                    ` : `
                                        <div class="found-item-actions mt-3">
                                            <span class="claimed-status"><i class="bi bi-check-circle"></i> Successfully Claimed</span>
                                        </div>
                                    `}
                                </div>
                            `;
                        } else {
                            const badgeClass = isRecovered ? 'badge-recovered' : 'badge-lost';
                            const badgeText = isRecovered ? 'Recovered' : 'Lost';
                            
                            resultsHtml += `
                                <div class="${cardClass}">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h5>${report.item}</h5>
                                            <div class="meta">
                                                <i class="bi bi-geo-alt"></i> ${report.location}
                                            </div>
                                            ${report.last_seen ? `
                                                <div class="meta">
                                                    <i class="bi bi-eye"></i> Last seen: ${report.last_seen}
                                                </div>
                                            ` : ''}
                                            <div class="meta">
                                                <i class="bi bi-clock"></i> ${date}
                                            </div>
                                            ${report.description ? `<p class="mt-2">${report.description}</p>` : ''}
                                        </div>
                                        <span class="badge ${badgeClass}">${badgeText}</span>
                                    </div>
                                    ${report.contact_info ? `
                                        <div class="mt-3">
                                            <i class="bi bi-whatsapp"></i> 
                                            <a href="https://wa.me/${report.contact_info.replace(/^0/, '234')}" target="_blank" class="fw-bold">Contact via WhatsApp: ${report.contact_info}</a>
                                        </div>
                                    ` : ''}
                                    ${!isRecovered ? `
                                        <div class="found-item-actions mt-3">
                                            <button class="btn btn-info btn-sm mark-recovered-btn" data-id="${report.id}" data-phone="${report.contact_info}">
                                                <i class="bi bi-check-circle"></i> Mark as Recovered
                                            </button>
                                            <button class="btn btn-primary btn-sm message-btn" data-id="${report.id}" data-type="lost">
                                                <i class="bi bi-chat-dots"></i> Send Message
                                            </button>
                                        </div>
                                    ` : `
                                        <div class="found-item-actions mt-3">
                                            <span class="claimed-status"><i class="bi bi-check-circle"></i> Successfully Recovered</span>
                                        </div>
                                    `}
                                </div>
                            `;
                        }
                    });
                    
                    searchResults.innerHTML = resultsHtml;
                    
                    // Add event listeners to "Mark as Claimed" buttons
                    document.querySelectorAll('.mark-claimed-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const itemId = this.getAttribute('data-id');
                            const itemPhone = this.getAttribute('data-phone');
                            currentItemToClaim = { id: itemId, phone: itemPhone };
                            
                            // Clear the verification code input
                            verificationCodeInput.value = '';
                            
                            verificationModal.show();
                        });
                    });
                    
                    // Add event listeners to "Mark as Recovered" buttons
                    document.querySelectorAll('.mark-recovered-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const itemId = this.getAttribute('data-id');
                            const itemPhone = this.getAttribute('data-phone');
                            currentItemToRecover = { id: itemId, phone: itemPhone };
                            
                            // Clear the verification code input
                            lostVerificationCodeInput.value = '';
                            
                            lostVerificationModal.show();
                        });
                    });
                    
                    // Add event listeners to "Send Message" buttons
                    document.querySelectorAll('.message-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const itemId = this.getAttribute('data-id');
                            const itemType = this.getAttribute('data-type');
                            
                            // Get the current user's report ID
                            const userReportId = localStorage.getItem('lastReportId');
                            
                            if (!userReportId) {
                                showToast('Please report a lost or found item first to start a conversation.', 'error');
                                return;
                            }
                            
                            // Start conversation between the two reports
                            startConversation(userReportId, itemId);
                        });
                    });
                }
            } catch (error) {
                console.error('Error searching items:', error);
                showToast('Failed to search items. Please try again.', 'error');
            } finally {
                searchLoading.style.display = 'none';
            }
        }
        
        // Find matching items (for lost item reporting)
        async function findMatchingItems(searchItem, type) {
            try {
                const snapshot = await database.ref('reports').once('value');
                const reports = snapshot.val();
                
                if (!reports) return [];
                
                const searchKeywords = searchItem.toLowerCase().split(' ');
                const matchingItems = [];
                
                Object.entries(reports).forEach(([key, report]) => {
                    if (report.type === type) {
                        const reportText = `${report.item} ${report.description || ''}`.toLowerCase();
                        const matchScore = searchKeywords.reduce((score, keyword) => {
                            return score + (reportText.includes(keyword) ? 1 : 0);
                        }, 0);
                        
                        if (matchScore > 0) {
                            matchingItems.push({...report, matchScore});
                        }
                    }
                });
                
                return matchingItems.sort((a, b) => b.matchScore - a.matchScore);
            } catch (error) {
                console.error('Error finding matching items:', error);
                return [];
            }
        }
        
        // Handle "Confirm and Mark as Claimed" button
        confirmClaimBtn.addEventListener('click', async () => {
            if (!currentItemToClaim) return;
            
            const enteredCode = verificationCodeInput.value.trim().toUpperCase();
            
            if (!enteredCode) {
                showToast('Please enter your verification code', 'error');
                return;
            }
            
            try {
                // Get the report to verify the code
                const reportSnapshot = await database.ref(`reports/${currentItemToClaim.id}`).once('value');
                const reportData = reportSnapshot.val();
                
                if (!reportData) {
                    showToast('Report not found', 'error');
                    return;
                }
                
                // Verify the code
                if (reportData.verification_code !== enteredCode) {
                    showToast('Invalid verification code. Please try again.', 'error');
                    return;
                }
                
                // Mark as claimed
                await database.ref(`reports/${currentItemToClaim.id}`).update({
                    claimed: true,
                    claimed_at: new Date().toISOString()
                });
                
                verificationModal.hide();
                showToast('Item has been marked as claimed successfully!');
                
                // Refresh search results if visible
                if (searchResults.innerHTML !== '') {
                    performSearch();
                }
                
                currentItemToClaim = null;
            } catch (error) {
                console.error('Error marking item as claimed:', error);
                showToast('Failed to mark item as claimed. Please try again.', 'error');
            }
        });
        
        // Handle "Confirm and Mark as Recovered" button
        confirmRecoveredBtn.addEventListener('click', async () => {
            if (!currentItemToRecover) return;
            
            const enteredCode = lostVerificationCodeInput.value.trim().toUpperCase();
            
            if (!enteredCode) {
                showToast('Please enter your verification code', 'error');
                return;
            }
            
            try {
                // Get the report to verify the code
                const reportSnapshot = await database.ref(`reports/${currentItemToRecover.id}`).once('value');
                const reportData = reportSnapshot.val();
                
                if (!reportData) {
                    showToast('Report not found', 'error');
                    return;
                }
                
                // Verify the code
                if (reportData.verification_code !== enteredCode) {
                    showToast('Invalid verification code. Please try again.', 'error');
                    return;
                }
                
                // Mark as recovered
                await database.ref(`reports/${currentItemToRecover.id}`).update({
                    recovered: true,
                    recovered_at: new Date().toISOString()
                });
                
                lostVerificationModal.hide();
                showToast('Item has been marked as recovered successfully!');
                
                // Refresh search results if visible
                if (searchResults.innerHTML !== '') {
                    performSearch();
                }
                
                currentItemToRecover = null;
            } catch (error) {
                console.error('Error marking item as recovered:', error);
                showToast('Failed to mark item as recovered. Please try again.', 'error');
            }
        });
        
        // Messaging event listeners
        refreshConversationsBtn.addEventListener('click', loadConversations);
        
        sendMessageBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        shareContactBtn.addEventListener('click', shareContactInfo);
        
        reportConversationBtn.addEventListener('click', reportConversation);
        
        submitReportBtn.addEventListener('click', submitReport);
        
        // Initialize
        window.addEventListener('load', () => {
            createParticles();
            loadConversations();
        });
    </script>
</body>
</html>
